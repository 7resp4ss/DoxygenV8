\hypertarget{classv8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_1_1ReadOnlyPromotionImpl}{}\doxysection{v8\+::internal\+::anonymous\+\_\+namespace\{read-\/only-\/promotion.cc\}\+::Read\+Only\+Promotion\+Impl Class Reference}
\label{classv8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_1_1ReadOnlyPromotionImpl}\index{v8::internal::anonymous\_namespace\lcurly{}read-\/only-\/promotion.cc\rcurly{}::ReadOnlyPromotionImpl@{v8::internal::anonymous\_namespace\lcurly{}read-\/only-\/promotion.cc\rcurly{}::ReadOnlyPromotionImpl}}


Inheritance diagram for v8\+::internal\+::anonymous\+\_\+namespace\{read-\/only-\/promotion.cc\}\+::Read\+Only\+Promotion\+Impl\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=284pt]{classv8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_1_1ReadOnlyPromotionImpl__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for v8\+::internal\+::anonymous\+\_\+namespace\{read-\/only-\/promotion.cc\}\+::Read\+Only\+Promotion\+Impl\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=284pt]{classv8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_1_1ReadOnlyPromotionImpl__coll__graph}
\end{center}
\end{figure}
\doxysubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
class \mbox{\hyperlink{classv8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_1_1ReadOnlyPromotionImpl_1_1UpdatePointersVisitor}{Update\+Pointers\+Visitor}}
\end{DoxyCompactItemize}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static void \mbox{\hyperlink{classv8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_1_1ReadOnlyPromotionImpl_ae55ff52427eee7e42c93a9be7d9216e4}{Copy\+To\+Read\+Only\+Heap}} (\mbox{\hyperlink{classv8_1_1internal_1_1Isolate}{Isolate}} $\ast$isolate, const std\+::vector$<$ \mbox{\hyperlink{classv8_1_1internal_1_1Tagged}{Tagged}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1HeapObject}{Heap\+Object}} $>$$>$ \&promotees, \mbox{\hyperlink{namespacev8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_a824c4cab632e1345be4d7ee08a713631}{Heap\+Object\+Map}} $\ast$moves)
\item 
static void \mbox{\hyperlink{classv8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_1_1ReadOnlyPromotionImpl_aca2d07ebd5c1beb9473bf03fea1d44c6}{Update\+Pointers}} (\mbox{\hyperlink{classv8_1_1internal_1_1Isolate}{Isolate}} $\ast$isolate, const \mbox{\hyperlink{classv8_1_1internal_1_1SafepointScope}{Safepoint\+Scope}} \&safepoint\+\_\+scope, const \mbox{\hyperlink{namespacev8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_a824c4cab632e1345be4d7ee08a713631}{Heap\+Object\+Map}} \&moves)
\item 
static void \mbox{\hyperlink{classv8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_1_1ReadOnlyPromotionImpl_a5a81a4fd05f9b5a2652523db6fe946bc}{Delete\+Dead\+Objects}} (\mbox{\hyperlink{classv8_1_1internal_1_1Isolate}{Isolate}} $\ast$isolate, const \mbox{\hyperlink{classv8_1_1internal_1_1SafepointScope}{Safepoint\+Scope}} \&safepoint\+\_\+scope, const \mbox{\hyperlink{namespacev8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_a824c4cab632e1345be4d7ee08a713631}{Heap\+Object\+Map}} \&moves)
\item 
static void \mbox{\hyperlink{classv8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_1_1ReadOnlyPromotionImpl_ac2569df3e492346c652057f63054e06d}{Verify}} (\mbox{\hyperlink{classv8_1_1internal_1_1Isolate}{Isolate}} $\ast$isolate, const \mbox{\hyperlink{classv8_1_1internal_1_1SafepointScope}{Safepoint\+Scope}} \&safepoint\+\_\+scope)
\end{DoxyCompactItemize}
\doxysubsection*{Static Private Member Functions}
\begin{DoxyCompactItemize}
\item 
static void \mbox{\hyperlink{classv8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_1_1ReadOnlyPromotionImpl_a7b666e505cb3286ee15f2d0995e24af3}{Log\+Promoted\+Object}} (\mbox{\hyperlink{classv8_1_1internal_1_1Tagged}{Tagged}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1HeapObject}{Heap\+Object}} $>$ src, \mbox{\hyperlink{classv8_1_1internal_1_1Tagged}{Tagged}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1HeapObject}{Heap\+Object}} $>$ dst)
\item 
static void \mbox{\hyperlink{classv8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_1_1ReadOnlyPromotionImpl_adca875e5477cc3768fcd5fa88198a4b7}{Log\+Promoted\+Code\+Pointer\+Table\+Entry}} (\mbox{\hyperlink{classv8_1_1internal_1_1Tagged}{Tagged}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1Code}{Code}} $>$ \mbox{\hyperlink{flag-definitions_8h_ae0e79c88adf5166f9befeb542c2acd8f}{code}}, \mbox{\hyperlink{namespacev8_1_1internal_a54c20f5dfc8e7939a3b11dbe2584a1b9}{Indirect\+Pointer\+Handle}} old\+\_\+handle, \mbox{\hyperlink{namespacev8_1_1internal_a54c20f5dfc8e7939a3b11dbe2584a1b9}{Indirect\+Pointer\+Handle}} new\+\_\+handle)
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


Definition at line 421 of file read-\/only-\/promotion.\+cc.



\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classv8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_1_1ReadOnlyPromotionImpl_ae55ff52427eee7e42c93a9be7d9216e4}\label{classv8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_1_1ReadOnlyPromotionImpl_ae55ff52427eee7e42c93a9be7d9216e4}} 
\index{v8::internal::anonymous\_namespace\lcurly{}read-\/only-\/promotion.cc\rcurly{}::ReadOnlyPromotionImpl@{v8::internal::anonymous\_namespace\lcurly{}read-\/only-\/promotion.cc\rcurly{}::ReadOnlyPromotionImpl}!CopyToReadOnlyHeap@{CopyToReadOnlyHeap}}
\index{CopyToReadOnlyHeap@{CopyToReadOnlyHeap}!v8::internal::anonymous\_namespace\lcurly{}read-\/only-\/promotion.cc\rcurly{}::ReadOnlyPromotionImpl@{v8::internal::anonymous\_namespace\lcurly{}read-\/only-\/promotion.cc\rcurly{}::ReadOnlyPromotionImpl}}
\doxysubsubsection{\texorpdfstring{CopyToReadOnlyHeap()}{CopyToReadOnlyHeap()}}
{\footnotesize\ttfamily static void v8\+::internal\+::anonymous\+\_\+namespace\{read-\/only-\/promotion.\+cc\}\+::Read\+Only\+Promotion\+Impl\+::\+Copy\+To\+Read\+Only\+Heap (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classv8_1_1internal_1_1Isolate}{Isolate}} $\ast$}]{isolate,  }\item[{const std\+::vector$<$ \mbox{\hyperlink{classv8_1_1internal_1_1Tagged}{Tagged}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1HeapObject}{Heap\+Object}} $>$$>$ \&}]{promotees,  }\item[{\mbox{\hyperlink{namespacev8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_a824c4cab632e1345be4d7ee08a713631}{Heap\+Object\+Map}} $\ast$}]{moves }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}



Definition at line 423 of file read-\/only-\/promotion.\+cc.


\begin{DoxyCode}{0}
\DoxyCodeLine{425                             \{}
\DoxyCodeLine{426     ReadOnlySpace* rospace = isolate-\/>heap()-\/>read\_only\_space();}
\DoxyCodeLine{427     \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacev8_1_1internal_a57f5ecf71b9a2757b0555b2be4c640b8}{Tagged<HeapObject>}} src : promotees) \{}
\DoxyCodeLine{428       \textcolor{keyword}{const} \textcolor{keywordtype}{int} \mbox{\hyperlink{flag-definitions_8h_a3df0b28b666e942ffb9d7d04acdb9715}{size}} = src-\/>Size(isolate);}
\DoxyCodeLine{429       \mbox{\hyperlink{namespacev8_1_1internal_a57f5ecf71b9a2757b0555b2be4c640b8}{Tagged<HeapObject>}} dst =}
\DoxyCodeLine{430           rospace-\/>AllocateRaw(\mbox{\hyperlink{flag-definitions_8h_a3df0b28b666e942ffb9d7d04acdb9715}{size}}, \mbox{\hyperlink{namespacev8_1_1internal_ab6431cd9205265cf49909abcac939803a89dfe630590dbfe7004e6de0fabec67b}{kTaggedAligned}}).ToObjectChecked();}
\DoxyCodeLine{431       \mbox{\hyperlink{classv8_1_1internal_1_1Heap_ac3641a0b7518d1536161ebcb69bc4be9}{Heap::CopyBlock}}(dst.address(), src.address(), \mbox{\hyperlink{flag-definitions_8h_a3df0b28b666e942ffb9d7d04acdb9715}{size}});}
\DoxyCodeLine{432       moves-\/>emplace(src, dst);}
\DoxyCodeLine{433 }
\DoxyCodeLine{434       \textcolor{keywordflow}{if} (\mbox{\hyperlink{v8config_8h_a67bd29db07c711b0fb11ff1c324ebb60}{V8\_UNLIKELY}}(\mbox{\hyperlink{namespacev8_1_1internal_aa9db791c05a0359859a321dcfec42e37}{v8\_flags}}.trace\_read\_only\_promotion\_verbose)) \{}
\DoxyCodeLine{435         \mbox{\hyperlink{classv8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_1_1ReadOnlyPromotionImpl_a7b666e505cb3286ee15f2d0995e24af3}{LogPromotedObject}}(src, dst);}
\DoxyCodeLine{436       \}}
\DoxyCodeLine{437     \}}
\DoxyCodeLine{438   \}}

\end{DoxyCode}


References v8\+::internal\+::\+Tagged$<$ Heap\+Object $>$\+::address(), v8\+::internal\+::\+Read\+Only\+Space\+::\+Allocate\+Raw(), v8\+::internal\+::\+Heap\+::\+Copy\+Block(), v8\+::internal\+::\+Isolate\+::heap(), v8\+::internal\+::k\+Tagged\+Aligned, v8\+::internal\+::\+Heap\+::read\+\_\+only\+\_\+space(), size(), v8\+::internal\+::\+Allocation\+Result\+::\+To\+Object\+Checked(), v8\+::internal\+::v8\+\_\+flags, and V8\+\_\+\+UNLIKELY.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classv8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_1_1ReadOnlyPromotionImpl_ae55ff52427eee7e42c93a9be7d9216e4_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classv8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_1_1ReadOnlyPromotionImpl_a5a81a4fd05f9b5a2652523db6fe946bc}\label{classv8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_1_1ReadOnlyPromotionImpl_a5a81a4fd05f9b5a2652523db6fe946bc}} 
\index{v8::internal::anonymous\_namespace\lcurly{}read-\/only-\/promotion.cc\rcurly{}::ReadOnlyPromotionImpl@{v8::internal::anonymous\_namespace\lcurly{}read-\/only-\/promotion.cc\rcurly{}::ReadOnlyPromotionImpl}!DeleteDeadObjects@{DeleteDeadObjects}}
\index{DeleteDeadObjects@{DeleteDeadObjects}!v8::internal::anonymous\_namespace\lcurly{}read-\/only-\/promotion.cc\rcurly{}::ReadOnlyPromotionImpl@{v8::internal::anonymous\_namespace\lcurly{}read-\/only-\/promotion.cc\rcurly{}::ReadOnlyPromotionImpl}}
\doxysubsubsection{\texorpdfstring{DeleteDeadObjects()}{DeleteDeadObjects()}}
{\footnotesize\ttfamily static void v8\+::internal\+::anonymous\+\_\+namespace\{read-\/only-\/promotion.\+cc\}\+::Read\+Only\+Promotion\+Impl\+::\+Delete\+Dead\+Objects (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classv8_1_1internal_1_1Isolate}{Isolate}} $\ast$}]{isolate,  }\item[{const \mbox{\hyperlink{classv8_1_1internal_1_1SafepointScope}{Safepoint\+Scope}} \&}]{safepoint\+\_\+scope,  }\item[{const \mbox{\hyperlink{namespacev8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_a824c4cab632e1345be4d7ee08a713631}{Heap\+Object\+Map}} \&}]{moves }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}



Definition at line 488 of file read-\/only-\/promotion.\+cc.


\begin{DoxyCode}{0}
\DoxyCodeLine{490                                                             \{}
\DoxyCodeLine{491     \textcolor{comment}{// After moving a source object to a new destination, overwrite the source}}
\DoxyCodeLine{492     \textcolor{comment}{// memory with a filler. This is needed for moved objects that are verified}}
\DoxyCodeLine{493     \textcolor{comment}{// by the heap verifier to have a 1-\/1 relation with some other object (e.g.}}
\DoxyCodeLine{494     \textcolor{comment}{// objects related to trusted space). The verifier won't compute liveness}}
\DoxyCodeLine{495     \textcolor{comment}{// and instead just iterates linearly over pages. Without this change the}}
\DoxyCodeLine{496     \textcolor{comment}{// verifier would fail on this now-\/dead object.}}
\DoxyCodeLine{497     \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} [src, dst] : moves) \{}
\DoxyCodeLine{498       \mbox{\hyperlink{src_2base_2logging_8h_a3e1cfef60e774a81f30eaddf26a3a274}{CHECK}}(!\mbox{\hyperlink{classv8_1_1internal_1_1HeapLayout_a91ac1680dc7f626bd8675e14ac660240}{HeapLayout::InReadOnlySpace}}(src));}
\DoxyCodeLine{499       isolate-\/>heap()-\/>CreateFillerObjectAt(src.address(), src-\/>Size(isolate));}
\DoxyCodeLine{500     \}}
\DoxyCodeLine{501   \}}

\end{DoxyCode}


References CHECK, v8\+::internal\+::\+Heap\+::\+Create\+Filler\+Object\+At(), v8\+::internal\+::\+Isolate\+::heap(), and v8\+::internal\+::\+Heap\+Layout\+::\+In\+Read\+Only\+Space().

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classv8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_1_1ReadOnlyPromotionImpl_a5a81a4fd05f9b5a2652523db6fe946bc_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classv8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_1_1ReadOnlyPromotionImpl_adca875e5477cc3768fcd5fa88198a4b7}\label{classv8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_1_1ReadOnlyPromotionImpl_adca875e5477cc3768fcd5fa88198a4b7}} 
\index{v8::internal::anonymous\_namespace\lcurly{}read-\/only-\/promotion.cc\rcurly{}::ReadOnlyPromotionImpl@{v8::internal::anonymous\_namespace\lcurly{}read-\/only-\/promotion.cc\rcurly{}::ReadOnlyPromotionImpl}!LogPromotedCodePointerTableEntry@{LogPromotedCodePointerTableEntry}}
\index{LogPromotedCodePointerTableEntry@{LogPromotedCodePointerTableEntry}!v8::internal::anonymous\_namespace\lcurly{}read-\/only-\/promotion.cc\rcurly{}::ReadOnlyPromotionImpl@{v8::internal::anonymous\_namespace\lcurly{}read-\/only-\/promotion.cc\rcurly{}::ReadOnlyPromotionImpl}}
\doxysubsubsection{\texorpdfstring{LogPromotedCodePointerTableEntry()}{LogPromotedCodePointerTableEntry()}}
{\footnotesize\ttfamily static void v8\+::internal\+::anonymous\+\_\+namespace\{read-\/only-\/promotion.\+cc\}\+::Read\+Only\+Promotion\+Impl\+::\+Log\+Promoted\+Code\+Pointer\+Table\+Entry (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classv8_1_1internal_1_1Tagged}{Tagged}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1Code}{Code}} $>$}]{code,  }\item[{\mbox{\hyperlink{namespacev8_1_1internal_a54c20f5dfc8e7939a3b11dbe2584a1b9}{Indirect\+Pointer\+Handle}}}]{old\+\_\+handle,  }\item[{\mbox{\hyperlink{namespacev8_1_1internal_a54c20f5dfc8e7939a3b11dbe2584a1b9}{Indirect\+Pointer\+Handle}}}]{new\+\_\+handle }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}, {\ttfamily [private]}}



Definition at line 765 of file read-\/only-\/promotion.\+cc.


\begin{DoxyCode}{0}
\DoxyCodeLine{767                                         \{}
\DoxyCodeLine{768     std::cout << \textcolor{stringliteral}{"{}ro-\/promotion: promoted code pointer table entry \{code "{}}}
\DoxyCodeLine{769               << \textcolor{keyword}{reinterpret\_cast<}\textcolor{keywordtype}{void}*\textcolor{keyword}{>}(\mbox{\hyperlink{flag-definitions_8h_ae0e79c88adf5166f9befeb542c2acd8f}{code}}.ptr()) << \textcolor{stringliteral}{"{} slot "{}}}
\DoxyCodeLine{770               << AsHex(old\_handle, 8, \textcolor{keyword}{true}) << \textcolor{stringliteral}{"{} to "{}}}
\DoxyCodeLine{771               << AsHex(new\_handle, 8, \textcolor{keyword}{true}) << \textcolor{stringliteral}{"{}\}\(\backslash\)n"{}};}
\DoxyCodeLine{772   \}}

\end{DoxyCode}


References code.

\mbox{\Hypertarget{classv8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_1_1ReadOnlyPromotionImpl_a7b666e505cb3286ee15f2d0995e24af3}\label{classv8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_1_1ReadOnlyPromotionImpl_a7b666e505cb3286ee15f2d0995e24af3}} 
\index{v8::internal::anonymous\_namespace\lcurly{}read-\/only-\/promotion.cc\rcurly{}::ReadOnlyPromotionImpl@{v8::internal::anonymous\_namespace\lcurly{}read-\/only-\/promotion.cc\rcurly{}::ReadOnlyPromotionImpl}!LogPromotedObject@{LogPromotedObject}}
\index{LogPromotedObject@{LogPromotedObject}!v8::internal::anonymous\_namespace\lcurly{}read-\/only-\/promotion.cc\rcurly{}::ReadOnlyPromotionImpl@{v8::internal::anonymous\_namespace\lcurly{}read-\/only-\/promotion.cc\rcurly{}::ReadOnlyPromotionImpl}}
\doxysubsubsection{\texorpdfstring{LogPromotedObject()}{LogPromotedObject()}}
{\footnotesize\ttfamily static void v8\+::internal\+::anonymous\+\_\+namespace\{read-\/only-\/promotion.\+cc\}\+::Read\+Only\+Promotion\+Impl\+::\+Log\+Promoted\+Object (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classv8_1_1internal_1_1Tagged}{Tagged}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1HeapObject}{Heap\+Object}} $>$}]{src,  }\item[{\mbox{\hyperlink{classv8_1_1internal_1_1Tagged}{Tagged}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1HeapObject}{Heap\+Object}} $>$}]{dst }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}, {\ttfamily [private]}}



Definition at line 758 of file read-\/only-\/promotion.\+cc.


\begin{DoxyCode}{0}
\DoxyCodeLine{759                                                         \{}
\DoxyCodeLine{760     std::cout << \textcolor{stringliteral}{"{}ro-\/promotion: promoted object \{from "{}}}
\DoxyCodeLine{761               << \textcolor{keyword}{reinterpret\_cast<}\textcolor{keywordtype}{void}*\textcolor{keyword}{>}(src.ptr()) << \textcolor{stringliteral}{"{} to "{}}}
\DoxyCodeLine{762               << \textcolor{keyword}{reinterpret\_cast<}\textcolor{keywordtype}{void}*\textcolor{keyword}{>}(dst.ptr()) << \textcolor{stringliteral}{"{}\}\(\backslash\)n"{}};}
\DoxyCodeLine{763   \}}

\end{DoxyCode}


References v8\+::internal\+::\+Tagged\+Impl$<$ k\+Ref\+Type, Storage\+Type $>$\+::ptr().

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classv8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_1_1ReadOnlyPromotionImpl_a7b666e505cb3286ee15f2d0995e24af3_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classv8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_1_1ReadOnlyPromotionImpl_aca2d07ebd5c1beb9473bf03fea1d44c6}\label{classv8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_1_1ReadOnlyPromotionImpl_aca2d07ebd5c1beb9473bf03fea1d44c6}} 
\index{v8::internal::anonymous\_namespace\lcurly{}read-\/only-\/promotion.cc\rcurly{}::ReadOnlyPromotionImpl@{v8::internal::anonymous\_namespace\lcurly{}read-\/only-\/promotion.cc\rcurly{}::ReadOnlyPromotionImpl}!UpdatePointers@{UpdatePointers}}
\index{UpdatePointers@{UpdatePointers}!v8::internal::anonymous\_namespace\lcurly{}read-\/only-\/promotion.cc\rcurly{}::ReadOnlyPromotionImpl@{v8::internal::anonymous\_namespace\lcurly{}read-\/only-\/promotion.cc\rcurly{}::ReadOnlyPromotionImpl}}
\doxysubsubsection{\texorpdfstring{UpdatePointers()}{UpdatePointers()}}
{\footnotesize\ttfamily static void v8\+::internal\+::anonymous\+\_\+namespace\{read-\/only-\/promotion.\+cc\}\+::Read\+Only\+Promotion\+Impl\+::\+Update\+Pointers (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classv8_1_1internal_1_1Isolate}{Isolate}} $\ast$}]{isolate,  }\item[{const \mbox{\hyperlink{classv8_1_1internal_1_1SafepointScope}{Safepoint\+Scope}} \&}]{safepoint\+\_\+scope,  }\item[{const \mbox{\hyperlink{namespacev8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_a824c4cab632e1345be4d7ee08a713631}{Heap\+Object\+Map}} \&}]{moves }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}



Definition at line 440 of file read-\/only-\/promotion.\+cc.


\begin{DoxyCode}{0}
\DoxyCodeLine{442                                                          \{}
\DoxyCodeLine{443     Heap* \mbox{\hyperlink{namespaceheap}{heap}} = isolate-\/>heap();}
\DoxyCodeLine{444 \textcolor{preprocessor}{\#ifdef V8\_COMPRESS\_POINTERS}}
\DoxyCodeLine{445     ExternalPointerTable::UnsealReadOnlySegmentScope unseal\_scope(}
\DoxyCodeLine{446         \&isolate-\/>external\_pointer\_table());}
\DoxyCodeLine{447 \textcolor{preprocessor}{\#endif  }\textcolor{comment}{// V8\_COMPRESS\_POINTERS}}
\DoxyCodeLine{448     UpdatePointersVisitor v(isolate, \&moves);}
\DoxyCodeLine{449 }
\DoxyCodeLine{450     \textcolor{comment}{// Iterate all roots.}}
\DoxyCodeLine{451     EmbedderStackStateScope stack\_scope(}
\DoxyCodeLine{452         isolate-\/>heap(), \mbox{\hyperlink{namespacev8_1_1internal_aaf09a39558f639935e293adba6962fc7ad15860417dc4fe071de45246b23edaaa}{EmbedderStackStateOrigin::kExplicitInvocation}},}
\DoxyCodeLine{453         StackState::kNoHeapPointers);}
\DoxyCodeLine{454     \mbox{\hyperlink{namespaceheap}{heap}}-\/>IterateRoots(\&v, base::EnumSet<SkipRoot>\{\});}
\DoxyCodeLine{455 }
\DoxyCodeLine{456     \textcolor{comment}{// Iterate all objects on the mutable heap.}}
\DoxyCodeLine{457     \textcolor{comment}{// We assume that a full and precise GC has reclaimed all dead objects}}
\DoxyCodeLine{458     \textcolor{comment}{// and therefore that no filtering of unreachable objects is required here.}}
\DoxyCodeLine{459     HeapObjectIterator it(\mbox{\hyperlink{namespaceheap}{heap}}, safepoint\_scope);}
\DoxyCodeLine{460     \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespacev8_1_1internal_a57f5ecf71b9a2757b0555b2be4c640b8}{Tagged<HeapObject>}} o = it.Next(); !o.is\_null(); o = it.Next()) \{}
\DoxyCodeLine{461       \mbox{\hyperlink{namespacev8_1_1internal_a5f672157ae21ec21c6452b35f5eb884c}{VisitObject}}(isolate, o, \&v);}
\DoxyCodeLine{462     \}}
\DoxyCodeLine{463 }
\DoxyCodeLine{464     \textcolor{comment}{// Iterate all objects we just copied into RO space.}}
\DoxyCodeLine{465     \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} [src, dst] : moves) \{}
\DoxyCodeLine{466       \mbox{\hyperlink{namespacev8_1_1internal_a5f672157ae21ec21c6452b35f5eb884c}{VisitObject}}(isolate, dst, \&v);}
\DoxyCodeLine{467     \}}
\DoxyCodeLine{468 }
\DoxyCodeLine{469 \textcolor{preprocessor}{\#ifdef V8\_ENABLE\_LEAPTIERING}}
\DoxyCodeLine{470     \textcolor{comment}{// Iterate all entries in the JSDispatchTable as they could contain}}
\DoxyCodeLine{471     \textcolor{comment}{// pointers to promoted Code objects.}}
\DoxyCodeLine{472     JSDispatchTable* \textcolor{keyword}{const} jdt = \mbox{\hyperlink{classv8_1_1internal_1_1IsolateGroup_a3ca6c5d3f2b884f5866595543d2e0fd7}{IsolateGroup::current}}()-\/>js\_dispatch\_table();}
\DoxyCodeLine{473     jdt-\/>IterateActiveEntriesIn(\mbox{\hyperlink{namespaceheap}{heap}}-\/>js\_dispatch\_table\_space(),}
\DoxyCodeLine{474                                 [\&](\mbox{\hyperlink{namespacev8_1_1internal_ae8f086a5ae078a9752085a6b967a135c}{JSDispatchHandle}} \mbox{\hyperlink{namespacev8_1_1internal_a8c89f00da07e125218128b9fbf0a321c}{handle}}) \{}
\DoxyCodeLine{475                                   Tagged<Code> old\_code = jdt-\/>GetCode(handle);}
\DoxyCodeLine{476                                   auto it = moves.find(old\_code);}
\DoxyCodeLine{477                                   if (it == moves.end()) return;}
\DoxyCodeLine{478                                   Tagged<HeapObject> new\_code = it-\/>second;}
\DoxyCodeLine{479                                   CHECK(IsCode(new\_code));}
\DoxyCodeLine{480                                   \textcolor{comment}{// TODO(saelo): is it worth logging something}}
\DoxyCodeLine{481                                   \textcolor{comment}{// in this case?}}
\DoxyCodeLine{482                                   jdt-\/>SetCodeNoWriteBarrier(}
\DoxyCodeLine{483                                       handle, Cast<Code>(new\_code));}
\DoxyCodeLine{484                                 \});}
\DoxyCodeLine{485 \textcolor{preprocessor}{\#endif  }\textcolor{comment}{// V8\_ENABLE\_LEAPTIERING}}
\DoxyCodeLine{486   \}}

\end{DoxyCode}


References v8\+::internal\+::\+Isolate\+Group\+::current(), v8\+::internal\+::handle(), v8\+::internal\+::\+Isolate\+::heap(), v8\+::internal\+::\+Tagged$<$ Heap\+Object $>$\+::is\+\_\+null(), v8\+::internal\+::k\+Explicit\+Invocation, v8\+::internal\+::\+Heap\+Object\+Iterator\+::\+Next(), and v8\+::internal\+::\+Visit\+Object().

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classv8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_1_1ReadOnlyPromotionImpl_aca2d07ebd5c1beb9473bf03fea1d44c6_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classv8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_1_1ReadOnlyPromotionImpl_ac2569df3e492346c652057f63054e06d}\label{classv8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_1_1ReadOnlyPromotionImpl_ac2569df3e492346c652057f63054e06d}} 
\index{v8::internal::anonymous\_namespace\lcurly{}read-\/only-\/promotion.cc\rcurly{}::ReadOnlyPromotionImpl@{v8::internal::anonymous\_namespace\lcurly{}read-\/only-\/promotion.cc\rcurly{}::ReadOnlyPromotionImpl}!Verify@{Verify}}
\index{Verify@{Verify}!v8::internal::anonymous\_namespace\lcurly{}read-\/only-\/promotion.cc\rcurly{}::ReadOnlyPromotionImpl@{v8::internal::anonymous\_namespace\lcurly{}read-\/only-\/promotion.cc\rcurly{}::ReadOnlyPromotionImpl}}
\doxysubsubsection{\texorpdfstring{Verify()}{Verify()}}
{\footnotesize\ttfamily static void v8\+::internal\+::anonymous\+\_\+namespace\{read-\/only-\/promotion.\+cc\}\+::Read\+Only\+Promotion\+Impl\+::\+Verify (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classv8_1_1internal_1_1Isolate}{Isolate}} $\ast$}]{isolate,  }\item[{const \mbox{\hyperlink{classv8_1_1internal_1_1SafepointScope}{Safepoint\+Scope}} \&}]{safepoint\+\_\+scope }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}



Definition at line 503 of file read-\/only-\/promotion.\+cc.


\begin{DoxyCode}{0}
\DoxyCodeLine{503                                                                               \{}
\DoxyCodeLine{504 \textcolor{preprocessor}{\#ifdef DEBUG}}
\DoxyCodeLine{505     \textcolor{comment}{// Verify that certain objects were promoted as expected.}}
\DoxyCodeLine{506     \textcolor{comment}{//}}
\DoxyCodeLine{507     \textcolor{comment}{// Known objects.}}
\DoxyCodeLine{508     Heap* \mbox{\hyperlink{namespaceheap}{heap}} = isolate-\/>heap();}
\DoxyCodeLine{509     \mbox{\hyperlink{src_2base_2logging_8h_a3e1cfef60e774a81f30eaddf26a3a274}{CHECK}}(\mbox{\hyperlink{classv8_1_1internal_1_1HeapLayout_a91ac1680dc7f626bd8675e14ac660240}{HeapLayout::InReadOnlySpace}}(}
\DoxyCodeLine{510         \mbox{\hyperlink{namespaceheap}{heap}}-\/>promise\_all\_resolve\_element\_closure\_shared\_fun()));}
\DoxyCodeLine{511     \mbox{\hyperlink{src_2base_2logging_8h_a3e1cfef60e774a81f30eaddf26a3a274}{CHECK}}(\mbox{\hyperlink{classv8_1_1internal_1_1HeapLayout_a91ac1680dc7f626bd8675e14ac660240}{HeapLayout::InReadOnlySpace}}(\mbox{\hyperlink{namespaceheap}{heap}}-\/>error\_stack\_getter\_fun\_template()));}
\DoxyCodeLine{512     \mbox{\hyperlink{src_2base_2logging_8h_a3e1cfef60e774a81f30eaddf26a3a274}{CHECK}}(\mbox{\hyperlink{classv8_1_1internal_1_1HeapLayout_a91ac1680dc7f626bd8675e14ac660240}{HeapLayout::InReadOnlySpace}}(\mbox{\hyperlink{namespaceheap}{heap}}-\/>error\_stack\_setter\_fun\_template()));}
\DoxyCodeLine{513 }
\DoxyCodeLine{514     \textcolor{comment}{// TODO(jgruber): Extend here with more objects as they are added to}}
\DoxyCodeLine{515     \textcolor{comment}{// the promotion algorithm.}}
\DoxyCodeLine{516 }
\DoxyCodeLine{517     \textcolor{comment}{// Builtin Code objects.}}
\DoxyCodeLine{518     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classv8_1_1internal_1_1Builtins_ac24aadac6cd8b8ff875cf8bb9f0a476b}{Builtins::kCodeObjectsAreInROSpace}}) \{}
\DoxyCodeLine{519       Builtins* builtins = isolate-\/>builtins();}
\DoxyCodeLine{520       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{namespacev8_1_1internal}{i}} = 0; \mbox{\hyperlink{namespacev8_1_1internal}{i}} < \mbox{\hyperlink{classv8_1_1internal_1_1Builtins_a382fb596cae93ead73c99dc709ba63e0}{Builtins::kBuiltinCount}}; \mbox{\hyperlink{namespacev8_1_1internal}{i}}++) \{}
\DoxyCodeLine{521         \mbox{\hyperlink{src_2base_2logging_8h_a3e1cfef60e774a81f30eaddf26a3a274}{CHECK}}(\mbox{\hyperlink{classv8_1_1internal_1_1HeapLayout_a91ac1680dc7f626bd8675e14ac660240}{HeapLayout::InReadOnlySpace}}(}
\DoxyCodeLine{522             builtins-\/>code(\textcolor{keyword}{static\_cast<}\mbox{\hyperlink{namespacev8_1_1internal_acc2e164143496f18b5ec68f8ab70af52}{Builtin}}\textcolor{keyword}{>}(\mbox{\hyperlink{namespacev8_1_1internal}{i}}))));}
\DoxyCodeLine{523       \}}
\DoxyCodeLine{524     \}}
\DoxyCodeLine{525 \textcolor{preprocessor}{\#endif  }\textcolor{comment}{// DEBUG}}
\DoxyCodeLine{526   \}}

\end{DoxyCode}


References v8\+::internal\+::\+Isolate\+::builtins(), CHECK, v8\+::internal\+::\+Builtins\+::code(), v8\+::internal\+::\+Isolate\+::heap(), v8\+::internal\+::\+Heap\+Layout\+::\+In\+Read\+Only\+Space(), v8\+::internal\+::\+Builtins\+::k\+Builtin\+Count, and v8\+::internal\+::\+Builtins\+::k\+Code\+Objects\+Are\+In\+ROSpace.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classv8_1_1internal_1_1anonymous__namespace_02read-only-promotion_8cc_03_1_1ReadOnlyPromotionImpl_ac2569df3e492346c652057f63054e06d_cgraph}
\end{center}
\end{figure}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
/mnt/\+V8\+Source\+Code/src/heap/\mbox{\hyperlink{read-only-promotion_8cc}{read-\/only-\/promotion.\+cc}}\end{DoxyCompactItemize}
