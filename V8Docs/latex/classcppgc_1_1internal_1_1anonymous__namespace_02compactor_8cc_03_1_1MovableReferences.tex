\hypertarget{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences}{}\doxysection{cppgc\+::internal\+::anonymous\+\_\+namespace\{compactor.\+cc\}\+::Movable\+References Class Reference}
\label{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences}\index{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences@{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences}}


Collaboration diagram for cppgc\+::internal\+::anonymous\+\_\+namespace\{compactor.\+cc\}\+::Movable\+References\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences__coll__graph}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_abf2e0828af2978b2bb97a37f3a9f4dbb}{Movable\+References}} (\mbox{\hyperlink{classcppgc_1_1internal_1_1HeapBase}{Heap\+Base}} \&\mbox{\hyperlink{flag-definitions_8h_a761e4e5929b1553283fd6a532822bb17}{heap}})
\item 
void \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_abdfe2fcfcfd789c085a79efac983ac14}{Add\+Or\+Filter}} (\mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_a14c87cab4ec29f48fa2ce9fc89e61f1c}{Movable\+Reference}} $\ast$)
\item 
void \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_a3ef09e30885b229ec4413ea7f5054e92}{Relocate}} (\mbox{\hyperlink{namespacecppgc_1_1internal_a5229c26742f473fcdcc68b715482635b}{Address}} from, \mbox{\hyperlink{namespacecppgc_1_1internal_a5229c26742f473fcdcc68b715482635b}{Address}} to, size\+\_\+t size\+\_\+including\+\_\+header)
\item 
void \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_adf721580283e48288292f503f7c499a5}{Relocate\+Interior\+References}} (\mbox{\hyperlink{namespacecppgc_1_1internal_a5229c26742f473fcdcc68b715482635b}{Address}} from, \mbox{\hyperlink{namespacecppgc_1_1internal_a5229c26742f473fcdcc68b715482635b}{Address}} to, size\+\_\+t \mbox{\hyperlink{flag-definitions_8h_a3df0b28b666e942ffb9d7d04acdb9715}{size}})
\item 
void \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_a94ad73f2dccf8e677bc9edb0cbd82566}{Update\+Callbacks}} ()
\end{DoxyCompactItemize}
\doxysubsection*{Private Types}
\begin{DoxyCompactItemize}
\item 
using \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_a14c87cab4ec29f48fa2ce9fc89e61f1c}{Movable\+Reference}} = \mbox{\hyperlink{classcppgc_1_1internal_1_1CompactionWorklists_a8dd0a0b83e3b0f72d2b53059304ce1d5}{Compaction\+Worklists\+::\+Movable\+Reference}}
\end{DoxyCompactItemize}
\doxysubsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classcppgc_1_1internal_1_1HeapBase}{Heap\+Base}} \& \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_adc919688cafbb3afc9a744bf5c25383f}{heap\+\_\+}}
\item 
std\+::unordered\+\_\+map$<$ \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_a14c87cab4ec29f48fa2ce9fc89e61f1c}{Movable\+Reference}}, \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_a14c87cab4ec29f48fa2ce9fc89e61f1c}{Movable\+Reference}} $\ast$ $>$ \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_aa1f7d1bbd03ae3ece48e0f3a10eebf4c}{movable\+\_\+references\+\_\+}}
\item 
std\+::map$<$ \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_a14c87cab4ec29f48fa2ce9fc89e61f1c}{Movable\+Reference}} $\ast$, \mbox{\hyperlink{namespacecppgc_1_1internal_a5229c26742f473fcdcc68b715482635b}{Address}} $>$ \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_af1fd8897c49222c584e7547634d389a2}{interior\+\_\+movable\+\_\+references\+\_\+}}
\item 
const bool \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_a966f7749736a8cba7d2b573778592056}{heap\+\_\+has\+\_\+move\+\_\+listeners\+\_\+}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


Definition at line 38 of file compactor.\+cc.



\doxysubsection{Member Typedef Documentation}
\mbox{\Hypertarget{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_a14c87cab4ec29f48fa2ce9fc89e61f1c}\label{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_a14c87cab4ec29f48fa2ce9fc89e61f1c}} 
\index{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences@{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences}!MovableReference@{MovableReference}}
\index{MovableReference@{MovableReference}!cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences@{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences}}
\doxysubsubsection{\texorpdfstring{MovableReference}{MovableReference}}
{\footnotesize\ttfamily using cppgc\+::internal\+::anonymous\+\_\+namespace\{compactor.\+cc\}\+::\mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_a14c87cab4ec29f48fa2ce9fc89e61f1c}{Movable\+References\+::\+Movable\+Reference}} =  \mbox{\hyperlink{classcppgc_1_1internal_1_1CompactionWorklists_a8dd0a0b83e3b0f72d2b53059304ce1d5}{Compaction\+Worklists\+::\+Movable\+Reference}}\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 39 of file compactor.\+cc.



\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_abf2e0828af2978b2bb97a37f3a9f4dbb}\label{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_abf2e0828af2978b2bb97a37f3a9f4dbb}} 
\index{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences@{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences}!MovableReferences@{MovableReferences}}
\index{MovableReferences@{MovableReferences}!cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences@{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences}}
\doxysubsubsection{\texorpdfstring{MovableReferences()}{MovableReferences()}}
{\footnotesize\ttfamily cppgc\+::internal\+::anonymous\+\_\+namespace\{compactor.\+cc\}\+::Movable\+References\+::\+Movable\+References (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classcppgc_1_1internal_1_1HeapBase}{Heap\+Base}} \&}]{heap }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [explicit]}}



Definition at line 42 of file compactor.\+cc.


\begin{DoxyCode}{0}
\DoxyCodeLine{43       : \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_adc919688cafbb3afc9a744bf5c25383f}{heap\_}}(\mbox{\hyperlink{namespaceheap}{heap}}), \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_a966f7749736a8cba7d2b573778592056}{heap\_has\_move\_listeners\_}}(\mbox{\hyperlink{namespaceheap}{heap}}.HasMoveListeners()) \{\}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_abdfe2fcfcfd789c085a79efac983ac14}\label{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_abdfe2fcfcfd789c085a79efac983ac14}} 
\index{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences@{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences}!AddOrFilter@{AddOrFilter}}
\index{AddOrFilter@{AddOrFilter}!cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences@{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences}}
\doxysubsubsection{\texorpdfstring{AddOrFilter()}{AddOrFilter()}}
{\footnotesize\ttfamily void cppgc\+::internal\+::anonymous\+\_\+namespace\{compactor.\+cc\}\+::Movable\+References\+::\+Add\+Or\+Filter (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_a14c87cab4ec29f48fa2ce9fc89e61f1c}{Movable\+Reference}} $\ast$}]{slot }\end{DoxyParamCaption})}



Definition at line 85 of file compactor.\+cc.


\begin{DoxyCode}{0}
\DoxyCodeLine{85                                                           \{}
\DoxyCodeLine{86   \textcolor{keyword}{const} BasePage* slot\_page = \mbox{\hyperlink{classcppgc_1_1internal_1_1BasePage_af1e5606c811fb5dcdbd60e1da987f409}{BasePage::FromInnerAddress}}(\&\mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_adc919688cafbb3afc9a744bf5c25383f}{heap\_}}, slot);}
\DoxyCodeLine{87   \mbox{\hyperlink{src_2base_2logging_8h_a9154b181227e4b02e465befe50219158}{CHECK\_NOT\_NULL}}(slot\_page);}
\DoxyCodeLine{88 }
\DoxyCodeLine{89   \textcolor{keyword}{const} \textcolor{keywordtype}{void}* \mbox{\hyperlink{namespacev8_1_1internal_ac1a33b5fd9af1653d346746cdb5c1ac0}{value}} = *slot;}
\DoxyCodeLine{90   \textcolor{keywordflow}{if} (!\mbox{\hyperlink{namespacev8_1_1internal_ac1a33b5fd9af1653d346746cdb5c1ac0}{value}}) \textcolor{keywordflow}{return};}
\DoxyCodeLine{91 }
\DoxyCodeLine{92   \textcolor{comment}{// All slots and values are part of Oilpan's heap.}}
\DoxyCodeLine{93   \textcolor{comment}{// -\/ Slots may be contained within dead objects if e.g. the write barrier}}
\DoxyCodeLine{94   \textcolor{comment}{//   registered the slot while backing itself has not been marked live in}}
\DoxyCodeLine{95   \textcolor{comment}{//   time. Slots in dead objects are filtered below.}}
\DoxyCodeLine{96   \textcolor{comment}{// -\/ Values may only be contained in or point to live objects.}}
\DoxyCodeLine{97 }
\DoxyCodeLine{98   \textcolor{keyword}{const} HeapObjectHeader\& slot\_header =}
\DoxyCodeLine{99       slot\_page-\/>ObjectHeaderFromInnerAddress(slot);}
\DoxyCodeLine{100   \textcolor{comment}{// Filter the slot since the object that contains the slot is dead.}}
\DoxyCodeLine{101   \textcolor{keywordflow}{if} (!slot\_header.IsMarked()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{102 }
\DoxyCodeLine{103   \textcolor{keyword}{const} BasePage* value\_page = \mbox{\hyperlink{classcppgc_1_1internal_1_1BasePage_af1e5606c811fb5dcdbd60e1da987f409}{BasePage::FromInnerAddress}}(\&\mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_adc919688cafbb3afc9a744bf5c25383f}{heap\_}}, \mbox{\hyperlink{namespacev8_1_1internal_ac1a33b5fd9af1653d346746cdb5c1ac0}{value}});}
\DoxyCodeLine{104   \mbox{\hyperlink{src_2base_2logging_8h_a9154b181227e4b02e465befe50219158}{CHECK\_NOT\_NULL}}(value\_page);}
\DoxyCodeLine{105 }
\DoxyCodeLine{106   \textcolor{comment}{// The following cases are not compacted and do not require recording:}}
\DoxyCodeLine{107   \textcolor{comment}{// -\/ Compactable object on large pages.}}
\DoxyCodeLine{108   \textcolor{comment}{// -\/ Compactable object on non-\/compactable spaces.}}
\DoxyCodeLine{109   \textcolor{keywordflow}{if} (value\_page-\/>is\_large() || !value\_page-\/>space().is\_compactable()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{110 }
\DoxyCodeLine{111   \textcolor{comment}{// Slots must reside in and values must point to live objects at this}}
\DoxyCodeLine{112   \textcolor{comment}{// point. |value| usually points to a separate object but can also point}}
\DoxyCodeLine{113   \textcolor{comment}{// to the an interior pointer in the same object storage which is why the}}
\DoxyCodeLine{114   \textcolor{comment}{// dynamic header lookup is required.}}
\DoxyCodeLine{115   \textcolor{keyword}{const} HeapObjectHeader\& value\_header =}
\DoxyCodeLine{116       value\_page-\/>ObjectHeaderFromInnerAddress(\mbox{\hyperlink{namespacev8_1_1internal_ac1a33b5fd9af1653d346746cdb5c1ac0}{value}});}
\DoxyCodeLine{117   \mbox{\hyperlink{src_2base_2logging_8h_a3e1cfef60e774a81f30eaddf26a3a274}{CHECK}}(value\_header.IsMarked());}
\DoxyCodeLine{118 }
\DoxyCodeLine{119   \textcolor{comment}{// Slots may have been recorded already but must point to the same value.}}
\DoxyCodeLine{120   \textcolor{keyword}{auto} reference\_it = \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_aa1f7d1bbd03ae3ece48e0f3a10eebf4c}{movable\_references\_}}.find(\mbox{\hyperlink{namespacev8_1_1internal_ac1a33b5fd9af1653d346746cdb5c1ac0}{value}});}
\DoxyCodeLine{121   \textcolor{keywordflow}{if} (\mbox{\hyperlink{v8config_8h_a67bd29db07c711b0fb11ff1c324ebb60}{V8\_UNLIKELY}}(reference\_it != \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_aa1f7d1bbd03ae3ece48e0f3a10eebf4c}{movable\_references\_}}.end())) \{}
\DoxyCodeLine{122     \mbox{\hyperlink{src_2base_2logging_8h_aca32614b4d2aea7dd9abdeb222bf02f3}{CHECK\_EQ}}(slot, reference\_it-\/>second);}
\DoxyCodeLine{123     \textcolor{keywordflow}{return};}
\DoxyCodeLine{124   \}}
\DoxyCodeLine{125 }
\DoxyCodeLine{126   \textcolor{comment}{// Add regular movable reference.}}
\DoxyCodeLine{127   \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_aa1f7d1bbd03ae3ece48e0f3a10eebf4c}{movable\_references\_}}.emplace(\mbox{\hyperlink{namespacev8_1_1internal_ac1a33b5fd9af1653d346746cdb5c1ac0}{value}}, slot);}
\DoxyCodeLine{128 }
\DoxyCodeLine{129   \textcolor{comment}{// Check whether the slot itself resides on a page that is compacted.}}
\DoxyCodeLine{130   \textcolor{keywordflow}{if} (\mbox{\hyperlink{v8config_8h_a4f489f1b838163ab33f251c9e470d938}{V8\_LIKELY}}(!slot\_page-\/>space().is\_compactable())) \textcolor{keywordflow}{return};}
\DoxyCodeLine{131 }
\DoxyCodeLine{132   \mbox{\hyperlink{src_2base_2logging_8h_aca32614b4d2aea7dd9abdeb222bf02f3}{CHECK\_EQ}}(\mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_af1fd8897c49222c584e7547634d389a2}{interior\_movable\_references\_}}.end(),}
\DoxyCodeLine{133            \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_af1fd8897c49222c584e7547634d389a2}{interior\_movable\_references\_}}.find(slot));}
\DoxyCodeLine{134   \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_af1fd8897c49222c584e7547634d389a2}{interior\_movable\_references\_}}.emplace(slot, \textcolor{keyword}{nullptr});}
\DoxyCodeLine{135 \textcolor{preprocessor}{\#if DEBUG}}
\DoxyCodeLine{136   interior\_slot\_to\_object\_.emplace(slot, slot\_header.ObjectStart());}
\DoxyCodeLine{137 \textcolor{preprocessor}{\#endif  }\textcolor{comment}{// DEBUG}}
\DoxyCodeLine{138 \}}

\end{DoxyCode}


References CHECK, CHECK\+\_\+\+EQ, CHECK\+\_\+\+NOT\+\_\+\+NULL, cppgc\+::internal\+::\+Base\+Page\+::\+From\+Inner\+Address(), cppgc\+::internal\+::\+Base\+Space\+::is\+\_\+compactable(), cppgc\+::internal\+::\+Base\+Page\+::is\+\_\+large(), cppgc\+::internal\+::\+Heap\+Object\+Header\+::\+Is\+Marked(), cppgc\+::internal\+::\+Base\+Page\+::\+Object\+Header\+From\+Inner\+Address(), cppgc\+::internal\+::\+Heap\+Object\+Header\+::\+Object\+Start(), cppgc\+::internal\+::\+Base\+Page\+::space(), V8\+\_\+\+LIKELY, V8\+\_\+\+UNLIKELY, and v8\+::internal\+::value.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_abdfe2fcfcfd789c085a79efac983ac14_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_a3ef09e30885b229ec4413ea7f5054e92}\label{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_a3ef09e30885b229ec4413ea7f5054e92}} 
\index{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences@{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences}!Relocate@{Relocate}}
\index{Relocate@{Relocate}!cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences@{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences}}
\doxysubsubsection{\texorpdfstring{Relocate()}{Relocate()}}
{\footnotesize\ttfamily void cppgc\+::internal\+::anonymous\+\_\+namespace\{compactor.\+cc\}\+::Movable\+References\+::\+Relocate (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacecppgc_1_1internal_a5229c26742f473fcdcc68b715482635b}{Address}}}]{from,  }\item[{\mbox{\hyperlink{namespacecppgc_1_1internal_a5229c26742f473fcdcc68b715482635b}{Address}}}]{to,  }\item[{size\+\_\+t}]{size\+\_\+including\+\_\+header }\end{DoxyParamCaption})}



Definition at line 140 of file compactor.\+cc.


\begin{DoxyCode}{0}
\DoxyCodeLine{141                                                                \{}
\DoxyCodeLine{142 \textcolor{preprocessor}{\#if DEBUG}}
\DoxyCodeLine{143   moved\_objects\_.insert(from);}
\DoxyCodeLine{144 \textcolor{preprocessor}{\#endif  }\textcolor{comment}{// DEBUG}}
\DoxyCodeLine{145 }
\DoxyCodeLine{146   \textcolor{keywordflow}{if} (\mbox{\hyperlink{v8config_8h_a67bd29db07c711b0fb11ff1c324ebb60}{V8\_UNLIKELY}}(\mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_a966f7749736a8cba7d2b573778592056}{heap\_has\_move\_listeners\_}})) \{}
\DoxyCodeLine{147     \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_adc919688cafbb3afc9a744bf5c25383f}{heap\_}}.\mbox{\hyperlink{classcppgc_1_1internal_1_1HeapBase_a1351afd3a4cce034fa79aaa39b29a63f}{CallMoveListeners}}(from -\/ \textcolor{keyword}{sizeof}(HeapObjectHeader),}
\DoxyCodeLine{148                             to -\/ \textcolor{keyword}{sizeof}(HeapObjectHeader),}
\DoxyCodeLine{149                             size\_including\_header);}
\DoxyCodeLine{150   \}}
\DoxyCodeLine{151 }
\DoxyCodeLine{152   \textcolor{comment}{// Interior slots always need to be processed for moved objects.}}
\DoxyCodeLine{153   \textcolor{comment}{// Consider an object A with slot A.x pointing to value B where A is}}
\DoxyCodeLine{154   \textcolor{comment}{// allocated on a movable page itself. When B is finally moved, it needs to}}
\DoxyCodeLine{155   \textcolor{comment}{// find the corresponding slot A.x. Object A may be moved already and the}}
\DoxyCodeLine{156   \textcolor{comment}{// memory may have been freed, which would result in a crash.}}
\DoxyCodeLine{157   \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_af1fd8897c49222c584e7547634d389a2}{interior\_movable\_references\_}}.empty()) \{}
\DoxyCodeLine{158     \textcolor{keyword}{const} HeapObjectHeader\& header = \mbox{\hyperlink{classcppgc_1_1internal_1_1HeapObjectHeader_a04b955c04b80d2a431dc2b96e4a85028}{HeapObjectHeader::FromObject}}(to);}
\DoxyCodeLine{159     \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{flag-definitions_8h_a3df0b28b666e942ffb9d7d04acdb9715}{size}} = header.ObjectSize();}
\DoxyCodeLine{160     \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_adf721580283e48288292f503f7c499a5}{RelocateInteriorReferences}}(from, to, \mbox{\hyperlink{flag-definitions_8h_a3df0b28b666e942ffb9d7d04acdb9715}{size}});}
\DoxyCodeLine{161   \}}
\DoxyCodeLine{162 }
\DoxyCodeLine{163   \textcolor{keyword}{auto} it = \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_aa1f7d1bbd03ae3ece48e0f3a10eebf4c}{movable\_references\_}}.find(from);}
\DoxyCodeLine{164   \textcolor{comment}{// This means that there is no corresponding slot for a live object.}}
\DoxyCodeLine{165   \textcolor{comment}{// This may happen because a mutator may change the slot to point to a}}
\DoxyCodeLine{166   \textcolor{comment}{// different object because e.g. incremental marking marked an object}}
\DoxyCodeLine{167   \textcolor{comment}{// as live that was later on replaced.}}
\DoxyCodeLine{168   \textcolor{keywordflow}{if} (it == \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_aa1f7d1bbd03ae3ece48e0f3a10eebf4c}{movable\_references\_}}.end()) \{}
\DoxyCodeLine{169     \textcolor{keywordflow}{return};}
\DoxyCodeLine{170   \}}
\DoxyCodeLine{171 }
\DoxyCodeLine{172   \textcolor{comment}{// If the object is referenced by a slot that is contained on a compacted}}
\DoxyCodeLine{173   \textcolor{comment}{// area itself, check whether it can be updated already.}}
\DoxyCodeLine{174   \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_a14c87cab4ec29f48fa2ce9fc89e61f1c}{MovableReference}}* slot = it-\/>second;}
\DoxyCodeLine{175   \textcolor{keyword}{auto} interior\_it = \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_af1fd8897c49222c584e7547634d389a2}{interior\_movable\_references\_}}.find(slot);}
\DoxyCodeLine{176   \textcolor{keywordflow}{if} (interior\_it != \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_af1fd8897c49222c584e7547634d389a2}{interior\_movable\_references\_}}.end()) \{}
\DoxyCodeLine{177     \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_a14c87cab4ec29f48fa2ce9fc89e61f1c}{MovableReference}}* slot\_location =}
\DoxyCodeLine{178         \textcolor{keyword}{reinterpret\_cast<}\mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_a14c87cab4ec29f48fa2ce9fc89e61f1c}{MovableReference}}*\textcolor{keyword}{>}(interior\_it-\/>second);}
\DoxyCodeLine{179     \textcolor{keywordflow}{if} (!slot\_location) \{}
\DoxyCodeLine{180       interior\_it-\/>second = to;}
\DoxyCodeLine{181 \textcolor{preprocessor}{\#if DEBUG}}
\DoxyCodeLine{182       \textcolor{comment}{// Check that the containing object has not been moved yet.}}
\DoxyCodeLine{183       \textcolor{keyword}{auto} reverse\_it = interior\_slot\_to\_object\_.find(slot);}
\DoxyCodeLine{184       \mbox{\hyperlink{src_2base_2logging_8h_a986dc8f4ec6dcd0644efe205c13f8eb7}{DCHECK\_NE}}(interior\_slot\_to\_object\_.end(), reverse\_it);}
\DoxyCodeLine{185       \mbox{\hyperlink{src_2base_2logging_8h_af9c313d74155f7f201955a939e24c71f}{DCHECK\_EQ}}(moved\_objects\_.end(), moved\_objects\_.find(reverse\_it-\/>second));}
\DoxyCodeLine{186 \textcolor{preprocessor}{\#endif  }\textcolor{comment}{// DEBUG}}
\DoxyCodeLine{187     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{188       slot = slot\_location;}
\DoxyCodeLine{189     \}}
\DoxyCodeLine{190   \}}
\DoxyCodeLine{191 }
\DoxyCodeLine{192   \textcolor{comment}{// Compaction is atomic so slot should not be updated during compaction.}}
\DoxyCodeLine{193   \mbox{\hyperlink{src_2base_2logging_8h_af9c313d74155f7f201955a939e24c71f}{DCHECK\_EQ}}(from, *slot);}
\DoxyCodeLine{194 }
\DoxyCodeLine{195   \textcolor{comment}{// Update the slots new value.}}
\DoxyCodeLine{196   *slot = to;}
\DoxyCodeLine{197 \}}

\end{DoxyCode}


References DCHECK\+\_\+\+EQ, DCHECK\+\_\+\+NE, cppgc\+::internal\+::\+Heap\+Object\+Header\+::\+From\+Object(), cppgc\+::internal\+::\+Heap\+Object\+Header\+::\+Object\+Size(), size(), and V8\+\_\+\+UNLIKELY.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_a3ef09e30885b229ec4413ea7f5054e92_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_adf721580283e48288292f503f7c499a5}\label{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_adf721580283e48288292f503f7c499a5}} 
\index{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences@{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences}!RelocateInteriorReferences@{RelocateInteriorReferences}}
\index{RelocateInteriorReferences@{RelocateInteriorReferences}!cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences@{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences}}
\doxysubsubsection{\texorpdfstring{RelocateInteriorReferences()}{RelocateInteriorReferences()}}
{\footnotesize\ttfamily void cppgc\+::internal\+::anonymous\+\_\+namespace\{compactor.\+cc\}\+::Movable\+References\+::\+Relocate\+Interior\+References (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacecppgc_1_1internal_a5229c26742f473fcdcc68b715482635b}{Address}}}]{from,  }\item[{\mbox{\hyperlink{namespacecppgc_1_1internal_a5229c26742f473fcdcc68b715482635b}{Address}}}]{to,  }\item[{size\+\_\+t}]{size }\end{DoxyParamCaption})}



Definition at line 199 of file compactor.\+cc.


\begin{DoxyCode}{0}
\DoxyCodeLine{200                                                                 \{}
\DoxyCodeLine{201   \textcolor{comment}{// |from| is a valid address for a slot.}}
\DoxyCodeLine{202   \textcolor{keyword}{auto} interior\_it = \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_af1fd8897c49222c584e7547634d389a2}{interior\_movable\_references\_}}.lower\_bound(}
\DoxyCodeLine{203       \textcolor{keyword}{reinterpret\_cast<}\mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_a14c87cab4ec29f48fa2ce9fc89e61f1c}{MovableReference}}*\textcolor{keyword}{>}(from));}
\DoxyCodeLine{204   \textcolor{keywordflow}{if} (interior\_it == \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_af1fd8897c49222c584e7547634d389a2}{interior\_movable\_references\_}}.end()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{205   \mbox{\hyperlink{src_2base_2logging_8h_aabec5c3b7a8628298a25f044dcf89c25}{DCHECK\_GE}}(\textcolor{keyword}{reinterpret\_cast<}\mbox{\hyperlink{namespacecppgc_1_1internal_a5229c26742f473fcdcc68b715482635b}{Address}}\textcolor{keyword}{>}(interior\_it-\/>first), from);}
\DoxyCodeLine{206 }
\DoxyCodeLine{207   \textcolor{keywordtype}{size\_t} offset = \textcolor{keyword}{reinterpret\_cast<}\mbox{\hyperlink{namespacecppgc_1_1internal_a5229c26742f473fcdcc68b715482635b}{Address}}\textcolor{keyword}{>}(interior\_it-\/>first) -\/ from;}
\DoxyCodeLine{208   \textcolor{keywordflow}{while} (offset < \mbox{\hyperlink{flag-definitions_8h_a3df0b28b666e942ffb9d7d04acdb9715}{size}}) \{}
\DoxyCodeLine{209     \textcolor{keywordflow}{if} (!interior\_it-\/>second) \{}
\DoxyCodeLine{210       \textcolor{comment}{// Update the interior reference value, so that when the object the slot}}
\DoxyCodeLine{211       \textcolor{comment}{// is pointing to is moved, it can reuse this value.}}
\DoxyCodeLine{212       \mbox{\hyperlink{namespacecppgc_1_1internal_a5229c26742f473fcdcc68b715482635b}{Address}} reference = to + offset;}
\DoxyCodeLine{213       interior\_it-\/>second = reference;}
\DoxyCodeLine{214 }
\DoxyCodeLine{215       \textcolor{comment}{// If the |slot|'s content is pointing into the region [from, from +}}
\DoxyCodeLine{216       \textcolor{comment}{// size) we are dealing with an interior pointer that does not point to}}
\DoxyCodeLine{217       \textcolor{comment}{// a valid HeapObjectHeader. Such references need to be fixed up}}
\DoxyCodeLine{218       \textcolor{comment}{// immediately.}}
\DoxyCodeLine{219       \mbox{\hyperlink{namespacecppgc_1_1internal_a5229c26742f473fcdcc68b715482635b}{Address}}\& reference\_contents = *\textcolor{keyword}{reinterpret\_cast<}\mbox{\hyperlink{namespacecppgc_1_1internal_a5229c26742f473fcdcc68b715482635b}{Address}}*\textcolor{keyword}{>}(reference);}
\DoxyCodeLine{220       \textcolor{keywordflow}{if} (reference\_contents > from \&\& reference\_contents < (from + \mbox{\hyperlink{flag-definitions_8h_a3df0b28b666e942ffb9d7d04acdb9715}{size}})) \{}
\DoxyCodeLine{221         reference\_contents = reference\_contents -\/ from + to;}
\DoxyCodeLine{222       \}}
\DoxyCodeLine{223     \}}
\DoxyCodeLine{224 }
\DoxyCodeLine{225     interior\_it++;}
\DoxyCodeLine{226     \textcolor{keywordflow}{if} (interior\_it == \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_af1fd8897c49222c584e7547634d389a2}{interior\_movable\_references\_}}.end()) \textcolor{keywordflow}{return};}
\DoxyCodeLine{227     offset = \textcolor{keyword}{reinterpret\_cast<}\mbox{\hyperlink{namespacecppgc_1_1internal_a5229c26742f473fcdcc68b715482635b}{Address}}\textcolor{keyword}{>}(interior\_it-\/>first) -\/ from;}
\DoxyCodeLine{228   \}}
\DoxyCodeLine{229 \}}

\end{DoxyCode}


References DCHECK\+\_\+\+GE, and size().

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_adf721580283e48288292f503f7c499a5_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_a94ad73f2dccf8e677bc9edb0cbd82566}\label{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_a94ad73f2dccf8e677bc9edb0cbd82566}} 
\index{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences@{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences}!UpdateCallbacks@{UpdateCallbacks}}
\index{UpdateCallbacks@{UpdateCallbacks}!cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences@{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences}}
\doxysubsubsection{\texorpdfstring{UpdateCallbacks()}{UpdateCallbacks()}}
{\footnotesize\ttfamily void cppgc\+::internal\+::anonymous\+\_\+namespace\{compactor.\+cc\}\+::Movable\+References\+::\+Update\+Callbacks (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



\doxysubsection{Member Data Documentation}
\mbox{\Hypertarget{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_adc919688cafbb3afc9a744bf5c25383f}\label{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_adc919688cafbb3afc9a744bf5c25383f}} 
\index{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences@{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences}!heap\_@{heap\_}}
\index{heap\_@{heap\_}!cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences@{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences}}
\doxysubsubsection{\texorpdfstring{heap\_}{heap\_}}
{\footnotesize\ttfamily \mbox{\hyperlink{classcppgc_1_1internal_1_1HeapBase}{Heap\+Base}}\& cppgc\+::internal\+::anonymous\+\_\+namespace\{compactor.\+cc\}\+::Movable\+References\+::heap\+\_\+\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 59 of file compactor.\+cc.

\mbox{\Hypertarget{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_a966f7749736a8cba7d2b573778592056}\label{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_a966f7749736a8cba7d2b573778592056}} 
\index{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences@{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences}!heap\_has\_move\_listeners\_@{heap\_has\_move\_listeners\_}}
\index{heap\_has\_move\_listeners\_@{heap\_has\_move\_listeners\_}!cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences@{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences}}
\doxysubsubsection{\texorpdfstring{heap\_has\_move\_listeners\_}{heap\_has\_move\_listeners\_}}
{\footnotesize\ttfamily const bool cppgc\+::internal\+::anonymous\+\_\+namespace\{compactor.\+cc\}\+::Movable\+References\+::heap\+\_\+has\+\_\+move\+\_\+listeners\+\_\+\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 74 of file compactor.\+cc.

\mbox{\Hypertarget{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_af1fd8897c49222c584e7547634d389a2}\label{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_af1fd8897c49222c584e7547634d389a2}} 
\index{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences@{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences}!interior\_movable\_references\_@{interior\_movable\_references\_}}
\index{interior\_movable\_references\_@{interior\_movable\_references\_}!cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences@{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences}}
\doxysubsubsection{\texorpdfstring{interior\_movable\_references\_}{interior\_movable\_references\_}}
{\footnotesize\ttfamily std\+::map$<$\mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_a14c87cab4ec29f48fa2ce9fc89e61f1c}{Movable\+Reference}}$\ast$, \mbox{\hyperlink{namespacecppgc_1_1internal_a5229c26742f473fcdcc68b715482635b}{Address}}$>$ cppgc\+::internal\+::anonymous\+\_\+namespace\{compactor.\+cc\}\+::Movable\+References\+::interior\+\_\+movable\+\_\+references\+\_\+\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 72 of file compactor.\+cc.

\mbox{\Hypertarget{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_aa1f7d1bbd03ae3ece48e0f3a10eebf4c}\label{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_aa1f7d1bbd03ae3ece48e0f3a10eebf4c}} 
\index{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences@{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences}!movable\_references\_@{movable\_references\_}}
\index{movable\_references\_@{movable\_references\_}!cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences@{cppgc::internal::anonymous\_namespace\lcurly{}compactor.cc\rcurly{}::MovableReferences}}
\doxysubsubsection{\texorpdfstring{movable\_references\_}{movable\_references\_}}
{\footnotesize\ttfamily std\+::unordered\+\_\+map$<$\mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_a14c87cab4ec29f48fa2ce9fc89e61f1c}{Movable\+Reference}}, \mbox{\hyperlink{classcppgc_1_1internal_1_1anonymous__namespace_02compactor_8cc_03_1_1MovableReferences_a14c87cab4ec29f48fa2ce9fc89e61f1c}{Movable\+Reference}}$\ast$$>$ cppgc\+::internal\+::anonymous\+\_\+namespace\{compactor.\+cc\}\+::Movable\+References\+::movable\+\_\+references\+\_\+\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 64 of file compactor.\+cc.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
/mnt/\+V8\+Source\+Code/src/heap/cppgc/\mbox{\hyperlink{compactor_8cc}{compactor.\+cc}}\end{DoxyCompactItemize}
