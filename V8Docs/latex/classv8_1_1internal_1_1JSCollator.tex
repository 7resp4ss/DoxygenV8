\hypertarget{classv8_1_1internal_1_1JSCollator}{}\doxysection{v8\+::internal\+::JSCollator Class Reference}
\label{classv8_1_1internal_1_1JSCollator}\index{v8::internal::JSCollator@{v8::internal::JSCollator}}


{\ttfamily \#include $<$js-\/collator.\+h$>$}



Inheritance diagram for v8\+::internal\+::JSCollator\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=227pt]{classv8_1_1internal_1_1JSCollator__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for v8\+::internal\+::JSCollator\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=227pt]{classv8_1_1internal_1_1JSCollator__coll__graph}
\end{center}
\end{figure}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{src_2base_2macros_8h_ab08e353943a53678ac6baafc678f2d81}{V8\+\_\+\+EXPORT\+\_\+\+PRIVATE}} static \mbox{\hyperlink{v8config_8h_a63258e4bf5dc9fb8c78f881c8405d83b}{V8\+\_\+\+WARN\+\_\+\+UNUSED\+\_\+\+RESULT}} \mbox{\hyperlink{classv8_1_1internal_1_1MaybeHandle}{Maybe\+Handle}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1JSCollator}{JSCollator}} $>$ \mbox{\hyperlink{classv8_1_1internal_1_1JSCollator_a58b6d3c38c02a21b8c92c7bf1cc3ed98}{New}} (\mbox{\hyperlink{classv8_1_1internal_1_1Isolate}{Isolate}} $\ast$isolate, \mbox{\hyperlink{classv8_1_1internal_1_1DirectHandle}{Direct\+Handle}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1Map}{Map}} $>$ map, \mbox{\hyperlink{classv8_1_1internal_1_1DirectHandle}{Direct\+Handle}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1Object}{Object}} $>$ locales, \mbox{\hyperlink{classv8_1_1internal_1_1DirectHandle}{Direct\+Handle}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1Object}{Object}} $>$ options, const char $\ast$service)
\item 
static \mbox{\hyperlink{classv8_1_1internal_1_1DirectHandle}{Direct\+Handle}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1JSObject}{JSObject}} $>$ \mbox{\hyperlink{classv8_1_1internal_1_1JSCollator_a69d3f92d9db02bf724e0c906a04afa29}{Resolved\+Options}} (\mbox{\hyperlink{classv8_1_1internal_1_1Isolate}{Isolate}} $\ast$isolate, \mbox{\hyperlink{classv8_1_1internal_1_1DirectHandle}{Direct\+Handle}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1JSCollator}{JSCollator}} $>$ collator)
\item 
static \mbox{\hyperlink{src_2base_2macros_8h_ab08e353943a53678ac6baafc678f2d81}{V8\+\_\+\+EXPORT\+\_\+\+PRIVATE}} const std\+::set$<$ std\+::string $>$ \& \mbox{\hyperlink{classv8_1_1internal_1_1JSCollator_a06f361e1a8c8b1a527601cb5f8480007}{Get\+Available\+Locales}} ()
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


Definition at line 34 of file js-\/collator.\+h.



\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classv8_1_1internal_1_1JSCollator_a06f361e1a8c8b1a527601cb5f8480007}\label{classv8_1_1internal_1_1JSCollator_a06f361e1a8c8b1a527601cb5f8480007}} 
\index{v8::internal::JSCollator@{v8::internal::JSCollator}!GetAvailableLocales@{GetAvailableLocales}}
\index{GetAvailableLocales@{GetAvailableLocales}!v8::internal::JSCollator@{v8::internal::JSCollator}}
\doxysubsubsection{\texorpdfstring{GetAvailableLocales()}{GetAvailableLocales()}}
{\footnotesize\ttfamily const std\+::set$<$ std\+::string $>$ \& v8\+::internal\+::\+JSCollator\+::\+Get\+Available\+Locales (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 591 of file js-\/collator.\+cc.


\begin{DoxyCode}{0}
\DoxyCodeLine{591                                                          \{}
\DoxyCodeLine{592   \textcolor{keyword}{static} \mbox{\hyperlink{structv8_1_1base_1_1LazyInstance_ad358db1e68d8b54c1cae1402c1fbce0f}{base::LazyInstance<CollatorAvailableLocales>::type}} available\_locales =}
\DoxyCodeLine{593       \mbox{\hyperlink{lazy-instance_8h_a1e27ae5d78f6269b5cbe602f43c91377}{LAZY\_INSTANCE\_INITIALIZER}};}
\DoxyCodeLine{594   \textcolor{keywordflow}{return} available\_locales.Pointer()-\/>Get();}
\DoxyCodeLine{595 \}}

\end{DoxyCode}


References LAZY\+\_\+\+INSTANCE\+\_\+\+INITIALIZER.



Referenced by v8\+::internal\+::\+BUILTIN(), and New().

Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classv8_1_1internal_1_1JSCollator_a06f361e1a8c8b1a527601cb5f8480007_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classv8_1_1internal_1_1JSCollator_a58b6d3c38c02a21b8c92c7bf1cc3ed98}\label{classv8_1_1internal_1_1JSCollator_a58b6d3c38c02a21b8c92c7bf1cc3ed98}} 
\index{v8::internal::JSCollator@{v8::internal::JSCollator}!New@{New}}
\index{New@{New}!v8::internal::JSCollator@{v8::internal::JSCollator}}
\doxysubsubsection{\texorpdfstring{New()}{New()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classv8_1_1internal_1_1MaybeHandle}{Maybe\+Handle}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1JSCollator}{JSCollator}} $>$ v8\+::internal\+::\+JSCollator\+::\+New (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classv8_1_1internal_1_1Isolate}{Isolate}} $\ast$}]{isolate,  }\item[{\mbox{\hyperlink{classv8_1_1internal_1_1DirectHandle}{Direct\+Handle}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1Map}{Map}} $>$}]{map,  }\item[{\mbox{\hyperlink{classv8_1_1internal_1_1DirectHandle}{Direct\+Handle}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1Object}{Object}} $>$}]{locales,  }\item[{\mbox{\hyperlink{classv8_1_1internal_1_1DirectHandle}{Direct\+Handle}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1Object}{Object}} $>$}]{options,  }\item[{const char $\ast$}]{service }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 281 of file js-\/collator.\+cc.


\begin{DoxyCode}{0}
\DoxyCodeLine{284                                                              \{}
\DoxyCodeLine{285   \textcolor{comment}{// 1. Let requestedLocales be ? CanonicalizeLocaleList(locales).}}
\DoxyCodeLine{286   Maybe<std::vector<std::string>> maybe\_requested\_locales =}
\DoxyCodeLine{287       \mbox{\hyperlink{classv8_1_1internal_1_1Intl_a48ffe5df7fd26755481624ec3fbc2bd8}{Intl::CanonicalizeLocaleList}}(isolate, locales);}
\DoxyCodeLine{288   \mbox{\hyperlink{execution_2isolate_8h_ab9c5f988388c2c537b8b161438e4ed31}{MAYBE\_RETURN}}(maybe\_requested\_locales, Handle<JSCollator>());}
\DoxyCodeLine{289   std::vector<std::string> requested\_locales =}
\DoxyCodeLine{290       maybe\_requested\_locales.FromJust();}
\DoxyCodeLine{291 }
\DoxyCodeLine{292   \textcolor{comment}{// 2. Set options to ? CoerceOptionsToObject(options).}}
\DoxyCodeLine{293   DirectHandle<JSReceiver> options;}
\DoxyCodeLine{294   \mbox{\hyperlink{execution_2isolate_8h_a45bb81ab232e9f2663545ec92dc0b950}{ASSIGN\_RETURN\_ON\_EXCEPTION}}(}
\DoxyCodeLine{295       isolate, options, \mbox{\hyperlink{namespacev8_1_1internal_ac4b6b53060a2878af798e2a2ce4e0295}{CoerceOptionsToObject}}(isolate, options\_obj, service));}
\DoxyCodeLine{296 }
\DoxyCodeLine{297   \textcolor{comment}{// 4. Let usage be ? GetOption(options, "{}usage"{}, "{}string"{}, « "{}sort"{},}}
\DoxyCodeLine{298   \textcolor{comment}{// "{}search"{} », "{}sort"{}).}}
\DoxyCodeLine{299   Maybe<Usage> maybe\_usage = GetStringOption<Usage>(}
\DoxyCodeLine{300       isolate, options, \textcolor{stringliteral}{"{}usage"{}}, service,}
\DoxyCodeLine{301       std::to\_array<const std::string\_view>(\{\textcolor{stringliteral}{"{}sort"{}}, \textcolor{stringliteral}{"{}search"{}}\}),}
\DoxyCodeLine{302       std::array\{Usage::SORT, Usage::SEARCH\}, Usage::SORT);}
\DoxyCodeLine{303   \mbox{\hyperlink{execution_2isolate_8h_ab9c5f988388c2c537b8b161438e4ed31}{MAYBE\_RETURN}}(maybe\_usage, MaybeHandle<JSCollator>());}
\DoxyCodeLine{304   \mbox{\hyperlink{namespacev8_1_1internal_1_1anonymous__namespace_02js-collator_8cc_03_a38f695c91ff2c3f90f72a989b4966c01}{Usage}} usage = maybe\_usage.FromJust();}
\DoxyCodeLine{305 }
\DoxyCodeLine{306   \textcolor{comment}{// 9. Let matcher be ? GetOption(options, "{}localeMatcher"{}, "{}string"{},}}
\DoxyCodeLine{307   \textcolor{comment}{// « "{}lookup"{}, "{}best fit"{} », "{}best fit"{}).}}
\DoxyCodeLine{308   \textcolor{comment}{// 10. Set opt.[[localeMatcher]] to matcher.}}
\DoxyCodeLine{309   Maybe<Intl::MatcherOption> maybe\_locale\_matcher =}
\DoxyCodeLine{310       \mbox{\hyperlink{classv8_1_1internal_1_1Intl_aa65b5c1f434fe74d5fd3e3ac87ca193f}{Intl::GetLocaleMatcher}}(isolate, options, service);}
\DoxyCodeLine{311   \mbox{\hyperlink{execution_2isolate_8h_ab9c5f988388c2c537b8b161438e4ed31}{MAYBE\_RETURN}}(maybe\_locale\_matcher, MaybeHandle<JSCollator>());}
\DoxyCodeLine{312   \mbox{\hyperlink{classv8_1_1internal_1_1Intl_afb4cf72c66834096fbb2f5c4761d9695}{Intl::MatcherOption}} matcher = maybe\_locale\_matcher.FromJust();}
\DoxyCodeLine{313 }
\DoxyCodeLine{314   \textcolor{comment}{// x. Let \_collation\_ be ? GetOption(\_options\_, *"{}collation"{}*, *"{}string"{}*,}}
\DoxyCodeLine{315   \textcolor{comment}{// *undefined*, *undefined*).}}
\DoxyCodeLine{316   DirectHandle<String> collation\_str;}
\DoxyCodeLine{317   Maybe<bool> maybe\_collation =}
\DoxyCodeLine{318       \mbox{\hyperlink{namespacev8_1_1internal_aad021edfabe256681c857b5546e4c529}{GetStringOption}}(isolate, options, \textcolor{stringliteral}{"{}collation"{}},}
\DoxyCodeLine{319                       std::span<std::string\_view>(), service, \&collation\_str);}
\DoxyCodeLine{320   \mbox{\hyperlink{execution_2isolate_8h_ab9c5f988388c2c537b8b161438e4ed31}{MAYBE\_RETURN}}(maybe\_collation, MaybeHandle<JSCollator>());}
\DoxyCodeLine{321 }
\DoxyCodeLine{322   \textcolor{comment}{// Unfortunately needs to be a std::string because of Intl::IsValidCollation}}
\DoxyCodeLine{323   \mbox{\hyperlink{namespacev8_1_1internal_af68b330f02476361ab10f531933b3381}{std::string}} collation\_stdstr;}
\DoxyCodeLine{324   \textcolor{comment}{// x. If \_collation\_ is not *undefined*, then}}
\DoxyCodeLine{325   \textcolor{keywordflow}{if} (maybe\_collation.FromJust()) \{}
\DoxyCodeLine{326     collation\_stdstr = collation\_str-\/>ToStdString();}
\DoxyCodeLine{327     \textcolor{comment}{// 1. If \_collation\_ does not match the Unicode Locale Identifier `type`}}
\DoxyCodeLine{328     \textcolor{comment}{// nonterminal, throw a *RangeError* exception.}}
\DoxyCodeLine{329     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classv8_1_1internal_1_1JSLocale_af913f48c1498467d5bdd609e51ea318f}{JSLocale::Is38AlphaNumList}}(collation\_stdstr)) \{}
\DoxyCodeLine{330       \mbox{\hyperlink{execution_2isolate_8h_a06699c63279f3987fe082aeaaab74b7e}{THROW\_NEW\_ERROR\_RETURN\_VALUE}}(}
\DoxyCodeLine{331           isolate,}
\DoxyCodeLine{332           NewRangeError(\mbox{\hyperlink{namespacev8_1_1internal_1_1anonymous__namespace_02isolate_8cc_03_afcab528259303a389ac8aa3d12b339a1a43517b08d21463aea1323cca40a40c91}{MessageTemplate::kInvalid}},}
\DoxyCodeLine{333                         isolate-\/>factory()-\/>collation\_string(), collation\_str),}
\DoxyCodeLine{334           MaybeHandle<JSCollator>());}
\DoxyCodeLine{335     \}}
\DoxyCodeLine{336   \}}
\DoxyCodeLine{337   \textcolor{comment}{// x. Set \_opt\_.[[co]] to \_collation\_.}}
\DoxyCodeLine{338 }
\DoxyCodeLine{339   \textcolor{comment}{// 11. Let numeric be ? GetOption(options, "{}numeric"{}, "{}boolean"{},}}
\DoxyCodeLine{340   \textcolor{comment}{// undefined, undefined).}}
\DoxyCodeLine{341   \textcolor{comment}{// 12. If numeric is not undefined, then}}
\DoxyCodeLine{342   \textcolor{comment}{//    a. Let numeric be ! ToString(numeric).}}
\DoxyCodeLine{343   \textcolor{comment}{//}}
\DoxyCodeLine{344   \textcolor{comment}{// Note: We omit the ToString(numeric) operation as it's not}}
\DoxyCodeLine{345   \textcolor{comment}{// observable. GetBoolOption returns a Boolean and}}
\DoxyCodeLine{346   \textcolor{comment}{// ToString(Boolean) is not side-\/effecting.}}
\DoxyCodeLine{347   \textcolor{comment}{//}}
\DoxyCodeLine{348   \textcolor{comment}{// 13. Set opt.[[kn]] to numeric.}}
\DoxyCodeLine{349   \textcolor{keywordtype}{bool} numeric;}
\DoxyCodeLine{350   Maybe<bool> found\_numeric =}
\DoxyCodeLine{351       \mbox{\hyperlink{namespacev8_1_1internal_ab003301edfc49bfd1d1c7333d8b869a8}{GetBoolOption}}(isolate, options, \textcolor{stringliteral}{"{}numeric"{}}, service, \&numeric);}
\DoxyCodeLine{352   \mbox{\hyperlink{execution_2isolate_8h_ab9c5f988388c2c537b8b161438e4ed31}{MAYBE\_RETURN}}(found\_numeric, MaybeHandle<JSCollator>());}
\DoxyCodeLine{353 }
\DoxyCodeLine{354   \textcolor{comment}{// 14. Let caseFirst be ? GetOption(options, "{}caseFirst"{}, "{}string"{},}}
\DoxyCodeLine{355   \textcolor{comment}{//     « "{}upper"{}, "{}lower"{}, "{}false"{} », undefined).}}
\DoxyCodeLine{356   Maybe<CaseFirst> maybe\_case\_first = \mbox{\hyperlink{namespacev8_1_1internal_1_1anonymous__namespace_02js-collator_8cc_03_a6b1a0168958751d269fea631d85aebcf}{GetCaseFirst}}(isolate, options, service);}
\DoxyCodeLine{357   \mbox{\hyperlink{execution_2isolate_8h_ab9c5f988388c2c537b8b161438e4ed31}{MAYBE\_RETURN}}(maybe\_case\_first, MaybeHandle<JSCollator>());}
\DoxyCodeLine{358   \mbox{\hyperlink{namespacev8_1_1internal_1_1anonymous__namespace_02js-collator_8cc_03_a8f9bba391e5cbadefe3d56d7953b0581}{CaseFirst}} case\_first = maybe\_case\_first.FromJust();}
\DoxyCodeLine{359 }
\DoxyCodeLine{360   \textcolor{comment}{// The relevant unicode extensions accepted by Collator as specified here:}}
\DoxyCodeLine{361   \textcolor{comment}{// https://tc39.github.io/ecma402/\#sec-\/intl-\/collator-\/internal-\/slots}}
\DoxyCodeLine{362   \textcolor{comment}{//}}
\DoxyCodeLine{363   \textcolor{comment}{// 16. Let relevantExtensionKeys be \%Collator\%.[[RelevantExtensionKeys]].}}
\DoxyCodeLine{364 }
\DoxyCodeLine{365   \textcolor{comment}{// 17. Let r be ResolveLocale(\%Collator\%.[[AvailableLocales]],}}
\DoxyCodeLine{366   \textcolor{comment}{// requestedLocales, opt, \%Collator\%.[[RelevantExtensionKeys]],}}
\DoxyCodeLine{367   \textcolor{comment}{// localeData).}}
\DoxyCodeLine{368   Intl::ResolvedLocale r;}
\DoxyCodeLine{369   \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classv8_1_1internal_1_1Intl_a57e751885fa0a74dd3f6c0a150857d65}{Intl::ResolveLocale}}(isolate, \mbox{\hyperlink{classv8_1_1internal_1_1JSCollator_a06f361e1a8c8b1a527601cb5f8480007}{JSCollator::GetAvailableLocales}}(),}
\DoxyCodeLine{370                            requested\_locales, matcher, \{\textcolor{stringliteral}{"{}co"{}}, \textcolor{stringliteral}{"{}kn"{}}, \textcolor{stringliteral}{"{}kf"{}}\})}
\DoxyCodeLine{371            .To(\&r)) \{}
\DoxyCodeLine{372     \mbox{\hyperlink{execution_2isolate_8h_a6557667dd5be0768bd92d4bfd9a4d70f}{THROW\_NEW\_ERROR}}(isolate, NewRangeError(MessageTemplate::kIcuError));}
\DoxyCodeLine{373   \}}
\DoxyCodeLine{374 }
\DoxyCodeLine{375   \textcolor{comment}{// 18. Set collator.[[Locale]] to r.[[locale]].}}
\DoxyCodeLine{376   icu::Locale icu\_locale = r.icu\_locale;}
\DoxyCodeLine{377   \mbox{\hyperlink{namespacev8_1_1internal_aa6b3743bd5d773c552654f2a6c3efa4a}{DCHECK}}(!icu\_locale.isBogus());}
\DoxyCodeLine{378 }
\DoxyCodeLine{379   \textcolor{comment}{// 19. Let collation be r.[[co]].}}
\DoxyCodeLine{380   UErrorCode \mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}} = U\_ZERO\_ERROR;}
\DoxyCodeLine{381   \textcolor{keywordflow}{if} (maybe\_collation.FromJust()) \{}
\DoxyCodeLine{382     \textcolor{keyword}{auto} co\_extension\_it = r.extensions.find(\textcolor{stringliteral}{"{}co"{}});}
\DoxyCodeLine{383     \textcolor{keywordflow}{if} (co\_extension\_it != r.extensions.end() \&\&}
\DoxyCodeLine{384         co\_extension\_it-\/>second != collation\_stdstr) \{}
\DoxyCodeLine{385       icu\_locale.setUnicodeKeywordValue(\textcolor{stringliteral}{"{}co"{}}, \textcolor{keyword}{nullptr}, \mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}});}
\DoxyCodeLine{386       \mbox{\hyperlink{namespacev8_1_1internal_aa6b3743bd5d773c552654f2a6c3efa4a}{DCHECK}}(U\_SUCCESS(\mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}}));}
\DoxyCodeLine{387     \}}
\DoxyCodeLine{388   \}}
\DoxyCodeLine{389 }
\DoxyCodeLine{390   \textcolor{comment}{// 5. Set collator.[[Usage]] to usage.}}
\DoxyCodeLine{391   \textcolor{comment}{//}}
\DoxyCodeLine{392   \textcolor{comment}{// 6. If usage is "{}sort"{}, then}}
\DoxyCodeLine{393   \textcolor{comment}{//    a. Let localeData be \%Collator\%.[[SortLocaleData]].}}
\DoxyCodeLine{394   \textcolor{comment}{// 7. Else,}}
\DoxyCodeLine{395   \textcolor{comment}{//    a. Let localeData be \%Collator\%.[[SearchLocaleData]].}}
\DoxyCodeLine{396   \textcolor{comment}{//}}
\DoxyCodeLine{397   \textcolor{comment}{// The Intl spec doesn't allow us to use "{}search"{} as an extension}}
\DoxyCodeLine{398   \textcolor{comment}{// value for collation as per:}}
\DoxyCodeLine{399   \textcolor{comment}{// https://tc39.github.io/ecma402/\#sec-\/intl-\/collator-\/internal-\/slots}}
\DoxyCodeLine{400   \textcolor{comment}{//}}
\DoxyCodeLine{401   \textcolor{comment}{// But the only way to pass the value "{}search"{} for collation from}}
\DoxyCodeLine{402   \textcolor{comment}{// the options object to ICU is to use the 'co' extension keyword.}}
\DoxyCodeLine{403   \textcolor{comment}{//}}
\DoxyCodeLine{404   \textcolor{comment}{// This will need to be filtered out when creating the}}
\DoxyCodeLine{405   \textcolor{comment}{// resolvedOptions object.}}
\DoxyCodeLine{406   \textcolor{keywordflow}{if} (usage == Usage::SEARCH) \{}
\DoxyCodeLine{407     UErrorCode set\_status = U\_ZERO\_ERROR;}
\DoxyCodeLine{408     icu\_locale.setUnicodeKeywordValue(\textcolor{stringliteral}{"{}co"{}}, \textcolor{stringliteral}{"{}search"{}}, set\_status);}
\DoxyCodeLine{409     \mbox{\hyperlink{namespacev8_1_1internal_aa6b3743bd5d773c552654f2a6c3efa4a}{DCHECK}}(U\_SUCCESS(set\_status));}
\DoxyCodeLine{410   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{411     \textcolor{keywordflow}{if} (maybe\_collation.FromJust() \&\&}
\DoxyCodeLine{412         \mbox{\hyperlink{classv8_1_1internal_1_1Intl_a4e83e9ef05e4eb5b5377ad723fbbbb72}{Intl::IsValidCollation}}(icu\_locale, collation\_stdstr)) \{}
\DoxyCodeLine{413       icu\_locale.setUnicodeKeywordValue(\textcolor{stringliteral}{"{}co"{}}, collation\_stdstr, \mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}});}
\DoxyCodeLine{414       \mbox{\hyperlink{namespacev8_1_1internal_aa6b3743bd5d773c552654f2a6c3efa4a}{DCHECK}}(U\_SUCCESS(\mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}}));}
\DoxyCodeLine{415     \}}
\DoxyCodeLine{416   \}}
\DoxyCodeLine{417 }
\DoxyCodeLine{418   \textcolor{comment}{// 20. If collation is null, let collation be "{}default"{}.}}
\DoxyCodeLine{419   \textcolor{comment}{// 21. Set collator.[[Collation]] to collation.}}
\DoxyCodeLine{420   \textcolor{comment}{//}}
\DoxyCodeLine{421   \textcolor{comment}{// We don't store the collation value as per the above two steps}}
\DoxyCodeLine{422   \textcolor{comment}{// here. The collation value can be looked up from icu::Collator on}}
\DoxyCodeLine{423   \textcolor{comment}{// demand, as part of Intl.Collator.prototype.resolvedOptions.}}
\DoxyCodeLine{424 }
\DoxyCodeLine{425   std::unique\_ptr<icu::Collator> icu\_collator(}
\DoxyCodeLine{426       icu::Collator::createInstance(icu\_locale, \mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}}));}
\DoxyCodeLine{427   \textcolor{keywordflow}{if} (U\_FAILURE(\mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}}) || icu\_collator == \textcolor{keyword}{nullptr}) \{}
\DoxyCodeLine{428     \mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}} = U\_ZERO\_ERROR;}
\DoxyCodeLine{429     \textcolor{comment}{// Remove extensions and try again.}}
\DoxyCodeLine{430     icu::Locale no\_extension\_locale(icu\_locale.getBaseName());}
\DoxyCodeLine{431     icu\_collator.reset(}
\DoxyCodeLine{432         icu::Collator::createInstance(no\_extension\_locale, \mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}}));}
\DoxyCodeLine{433 }
\DoxyCodeLine{434     \textcolor{keywordflow}{if} (U\_FAILURE(\mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}}) || icu\_collator == \textcolor{keyword}{nullptr}) \{}
\DoxyCodeLine{435       \mbox{\hyperlink{execution_2isolate_8h_a6557667dd5be0768bd92d4bfd9a4d70f}{THROW\_NEW\_ERROR}}(isolate, NewRangeError(MessageTemplate::kIcuError));}
\DoxyCodeLine{436     \}}
\DoxyCodeLine{437   \}}
\DoxyCodeLine{438   \mbox{\hyperlink{namespacev8_1_1internal_aa6b3743bd5d773c552654f2a6c3efa4a}{DCHECK}}(U\_SUCCESS(\mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}}));}
\DoxyCodeLine{439 }
\DoxyCodeLine{440   icu::Locale collator\_locale(}
\DoxyCodeLine{441       icu\_collator-\/>getLocale(ULOC\_VALID\_LOCALE, \mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}}));}
\DoxyCodeLine{442 }
\DoxyCodeLine{443   \textcolor{comment}{// 22. If relevantExtensionKeys contains "{}kn"{}, then}}
\DoxyCodeLine{444   \textcolor{comment}{//     a. Set collator.[[Numeric]] to ! SameValue(r.[[kn]], "{}true"{}).}}
\DoxyCodeLine{445   \textcolor{comment}{//}}
\DoxyCodeLine{446   \textcolor{comment}{// If the numeric value is passed in through the options object,}}
\DoxyCodeLine{447   \textcolor{comment}{// then we use it. Otherwise, we check if the numeric value is}}
\DoxyCodeLine{448   \textcolor{comment}{// passed in through the unicode extensions.}}
\DoxyCodeLine{449   \mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}} = U\_ZERO\_ERROR;}
\DoxyCodeLine{450   \textcolor{keywordflow}{if} (found\_numeric.FromJust()) \{}
\DoxyCodeLine{451     \mbox{\hyperlink{namespacev8_1_1internal_1_1anonymous__namespace_02js-collator_8cc_03_a2215156b6e803c28a170bce9ba0321d2}{SetNumericOption}}(icu\_collator.get(), numeric);}
\DoxyCodeLine{452   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{453     \textcolor{keyword}{auto} kn\_extension\_it = r.extensions.find(\textcolor{stringliteral}{"{}kn"{}});}
\DoxyCodeLine{454     \textcolor{keywordflow}{if} (kn\_extension\_it != r.extensions.end()) \{}
\DoxyCodeLine{455       \mbox{\hyperlink{namespacev8_1_1internal_1_1anonymous__namespace_02js-collator_8cc_03_a2215156b6e803c28a170bce9ba0321d2}{SetNumericOption}}(icu\_collator.get(), (kn\_extension\_it-\/>second == \textcolor{stringliteral}{"{}true"{}}));}
\DoxyCodeLine{456     \}}
\DoxyCodeLine{457   \}}
\DoxyCodeLine{458 }
\DoxyCodeLine{459   \textcolor{comment}{// 23. If relevantExtensionKeys contains "{}kf"{}, then}}
\DoxyCodeLine{460   \textcolor{comment}{//     a. Set collator.[[CaseFirst]] to r.[[kf]].}}
\DoxyCodeLine{461   \textcolor{comment}{//}}
\DoxyCodeLine{462   \textcolor{comment}{// If the caseFirst value is passed in through the options object,}}
\DoxyCodeLine{463   \textcolor{comment}{// then we use it. Otherwise, we check if the caseFirst value is}}
\DoxyCodeLine{464   \textcolor{comment}{// passed in through the unicode extensions.}}
\DoxyCodeLine{465   \textcolor{keywordflow}{if} (case\_first != CaseFirst::kUndefined) \{}
\DoxyCodeLine{466     \mbox{\hyperlink{namespacev8_1_1internal_1_1anonymous__namespace_02js-collator_8cc_03_a579dfeff694df7482d784be71769577b}{SetCaseFirstOption}}(icu\_collator.get(), case\_first);}
\DoxyCodeLine{467   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{468     \textcolor{keyword}{auto} kf\_extension\_it = r.extensions.find(\textcolor{stringliteral}{"{}kf"{}});}
\DoxyCodeLine{469     \textcolor{keywordflow}{if} (kf\_extension\_it != r.extensions.end()) \{}
\DoxyCodeLine{470       \mbox{\hyperlink{namespacev8_1_1internal_1_1anonymous__namespace_02js-collator_8cc_03_a579dfeff694df7482d784be71769577b}{SetCaseFirstOption}}(icu\_collator.get(),}
\DoxyCodeLine{471                          \mbox{\hyperlink{namespacev8_1_1internal_1_1anonymous__namespace_02js-collator_8cc_03_ad4870e6aaa17a4ef985ba6b391c13633}{ToCaseFirst}}(kf\_extension\_it-\/>second.c\_str()));}
\DoxyCodeLine{472     \}}
\DoxyCodeLine{473   \}}
\DoxyCodeLine{474 }
\DoxyCodeLine{475   \textcolor{comment}{// Normalization is always on, by the spec. We are free to optimize}}
\DoxyCodeLine{476   \textcolor{comment}{// if the strings are already normalized (but we don't have a way to tell}}
\DoxyCodeLine{477   \textcolor{comment}{// that right now).}}
\DoxyCodeLine{478   \mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}} = U\_ZERO\_ERROR;}
\DoxyCodeLine{479   icu\_collator-\/>setAttribute(UCOL\_NORMALIZATION\_MODE, UCOL\_ON, \mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}});}
\DoxyCodeLine{480   \mbox{\hyperlink{namespacev8_1_1internal_aa6b3743bd5d773c552654f2a6c3efa4a}{DCHECK}}(U\_SUCCESS(\mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}}));}
\DoxyCodeLine{481 }
\DoxyCodeLine{482   \textcolor{comment}{// 24. Let sensitivity be ? GetOption(options, "{}sensitivity"{},}}
\DoxyCodeLine{483   \textcolor{comment}{// "{}string"{}, « "{}base"{}, "{}accent"{}, "{}case"{}, "{}variant"{} », undefined).}}
\DoxyCodeLine{484   Maybe<Sensitivity> maybe\_sensitivity = GetStringOption<Sensitivity>(}
\DoxyCodeLine{485       isolate, options, \textcolor{stringliteral}{"{}sensitivity"{}}, service,}
\DoxyCodeLine{486       std::to\_array<const std::string\_view>(}
\DoxyCodeLine{487           \{\textcolor{stringliteral}{"{}base"{}}, \textcolor{stringliteral}{"{}accent"{}}, \textcolor{stringliteral}{"{}case"{}}, \textcolor{stringliteral}{"{}variant"{}}\}),}
\DoxyCodeLine{488       std::array\{Sensitivity::kBase, Sensitivity::kAccent, Sensitivity::kCase,}
\DoxyCodeLine{489                  Sensitivity::kVariant\},}
\DoxyCodeLine{490       Sensitivity::kUndefined);}
\DoxyCodeLine{491   \mbox{\hyperlink{execution_2isolate_8h_ab9c5f988388c2c537b8b161438e4ed31}{MAYBE\_RETURN}}(maybe\_sensitivity, MaybeHandle<JSCollator>());}
\DoxyCodeLine{492   \mbox{\hyperlink{namespacev8_1_1internal_1_1anonymous__namespace_02js-collator_8cc_03_afe1fb5da973fcde5d31669b7bc67a1d4}{Sensitivity}} sensitivity = maybe\_sensitivity.FromJust();}
\DoxyCodeLine{493 }
\DoxyCodeLine{494   \textcolor{comment}{// 25. If sensitivity is undefined, then}}
\DoxyCodeLine{495   \textcolor{keywordflow}{if} (sensitivity == Sensitivity::kUndefined) \{}
\DoxyCodeLine{496     \textcolor{comment}{// 25. a. If usage is "{}sort"{}, then}}
\DoxyCodeLine{497     \textcolor{keywordflow}{if} (usage == Usage::SORT) \{}
\DoxyCodeLine{498       \textcolor{comment}{// 25. a. i. Let sensitivity be "{}variant"{}.}}
\DoxyCodeLine{499       sensitivity = Sensitivity::kVariant;}
\DoxyCodeLine{500     \}}
\DoxyCodeLine{501   \}}
\DoxyCodeLine{502   \textcolor{comment}{// 26. Set collator.[[Sensitivity]] to sensitivity.}}
\DoxyCodeLine{503   \textcolor{keywordflow}{switch} (sensitivity) \{}
\DoxyCodeLine{504     \textcolor{keywordflow}{case} Sensitivity::kBase:}
\DoxyCodeLine{505       icu\_collator-\/>setStrength(icu::Collator::PRIMARY);}
\DoxyCodeLine{506       \textcolor{keywordflow}{break};}
\DoxyCodeLine{507     \textcolor{keywordflow}{case} Sensitivity::kAccent:}
\DoxyCodeLine{508       icu\_collator-\/>setStrength(icu::Collator::SECONDARY);}
\DoxyCodeLine{509       \textcolor{keywordflow}{break};}
\DoxyCodeLine{510     \textcolor{keywordflow}{case} Sensitivity::kCase:}
\DoxyCodeLine{511       icu\_collator-\/>setStrength(icu::Collator::PRIMARY);}
\DoxyCodeLine{512       \mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}} = U\_ZERO\_ERROR;}
\DoxyCodeLine{513       icu\_collator-\/>setAttribute(UCOL\_CASE\_LEVEL, UCOL\_ON, \mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}});}
\DoxyCodeLine{514       \mbox{\hyperlink{namespacev8_1_1internal_aa6b3743bd5d773c552654f2a6c3efa4a}{DCHECK}}(U\_SUCCESS(\mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}}));}
\DoxyCodeLine{515       \textcolor{keywordflow}{break};}
\DoxyCodeLine{516     \textcolor{keywordflow}{case} Sensitivity::kVariant:}
\DoxyCodeLine{517       icu\_collator-\/>setStrength(icu::Collator::TERTIARY);}
\DoxyCodeLine{518       \textcolor{keywordflow}{break};}
\DoxyCodeLine{519     \textcolor{keywordflow}{case} Sensitivity::kUndefined:}
\DoxyCodeLine{520       \textcolor{keywordflow}{break};}
\DoxyCodeLine{521   \}}
\DoxyCodeLine{522 }
\DoxyCodeLine{523   \textcolor{comment}{// 27.Let ignorePunctuation be ? GetOption(options,}}
\DoxyCodeLine{524   \textcolor{comment}{// "{}ignorePunctuation"{}, "{}boolean"{}, undefined, false).}}
\DoxyCodeLine{525   \textcolor{keywordtype}{bool} ignore\_punctuation = \textcolor{keyword}{false};}
\DoxyCodeLine{526   Maybe<bool> found\_ignore\_punctuation = \mbox{\hyperlink{namespacev8_1_1internal_ab003301edfc49bfd1d1c7333d8b869a8}{GetBoolOption}}(}
\DoxyCodeLine{527       isolate, options, \textcolor{stringliteral}{"{}ignorePunctuation"{}}, service, \&ignore\_punctuation);}
\DoxyCodeLine{528   \mbox{\hyperlink{execution_2isolate_8h_ab9c5f988388c2c537b8b161438e4ed31}{MAYBE\_RETURN}}(found\_ignore\_punctuation, MaybeHandle<JSCollator>());}
\DoxyCodeLine{529 }
\DoxyCodeLine{530   \textcolor{comment}{// 28. Set collator.[[IgnorePunctuation]] to ignorePunctuation.}}
\DoxyCodeLine{531 }
\DoxyCodeLine{532   \textcolor{comment}{// Note: The following implementation does not strictly follow the spec text}}
\DoxyCodeLine{533   \textcolor{comment}{// due to https://github.com/tc39/ecma402/issues/832}}
\DoxyCodeLine{534   \textcolor{comment}{// If the ignorePunctuation is not defined, instead of fall back}}
\DoxyCodeLine{535   \textcolor{comment}{// to default false, we just depend on ICU to default based on the}}
\DoxyCodeLine{536   \textcolor{comment}{// built in locale collation rule, which in "{}th"{} locale that is true}}
\DoxyCodeLine{537   \textcolor{comment}{// but false on other locales.}}
\DoxyCodeLine{538   \textcolor{keywordflow}{if} (found\_ignore\_punctuation.FromJust()) \{}
\DoxyCodeLine{539     \mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}} = U\_ZERO\_ERROR;}
\DoxyCodeLine{540     icu\_collator-\/>setAttribute(}
\DoxyCodeLine{541         UCOL\_ALTERNATE\_HANDLING,}
\DoxyCodeLine{542         ignore\_punctuation ? UCOL\_SHIFTED : UCOL\_NON\_IGNORABLE, \mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}});}
\DoxyCodeLine{543     \mbox{\hyperlink{namespacev8_1_1internal_aa6b3743bd5d773c552654f2a6c3efa4a}{DCHECK}}(U\_SUCCESS(\mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}}));}
\DoxyCodeLine{544   \}}
\DoxyCodeLine{545 }
\DoxyCodeLine{546   DirectHandle<Managed<icu::Collator>> managed\_collator =}
\DoxyCodeLine{547       \mbox{\hyperlink{classv8_1_1internal_1_1Managed_a1c10cb948281b864db32d8af25a7b7d9}{Managed<icu::Collator>::From}}(isolate, 0, std::move(icu\_collator));}
\DoxyCodeLine{548 }
\DoxyCodeLine{549   \textcolor{comment}{// We only need to do so if it is different from the collator would return.}}
\DoxyCodeLine{550   DirectHandle<String> locale\_str =}
\DoxyCodeLine{551       isolate-\/>factory()-\/>NewStringFromAsciiChecked(}
\DoxyCodeLine{552           (collator\_locale != icu\_locale) ? r.locale.c\_str() : \textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{553   \textcolor{comment}{// Now all properties are ready, so we can allocate the result object.}}
\DoxyCodeLine{554   Handle<JSCollator> collator =}
\DoxyCodeLine{555       Cast<JSCollator>(isolate-\/>factory()-\/>NewFastOrSlowJSObjectFromMap(map));}
\DoxyCodeLine{556   \mbox{\hyperlink{namespacev8_1_1internal_af2248a427f8ff8f81e68a2a87758e145}{DisallowGarbageCollection}} \mbox{\hyperlink{namespacev8_1_1internal_1_1anonymous__namespace_02json-stringifier_8cc_03_a63d8eefb47468aa3f816fbe26a59466a}{no\_gc}};}
\DoxyCodeLine{557   collator-\/>set\_icu\_collator(*managed\_collator);}
\DoxyCodeLine{558   collator-\/>set\_locale(*locale\_str);}
\DoxyCodeLine{559 }
\DoxyCodeLine{560   \textcolor{comment}{// 29. Return collator.}}
\DoxyCodeLine{561   \textcolor{keywordflow}{return} collator;}
\DoxyCodeLine{562 \}}

\end{DoxyCode}


References ASSIGN\+\_\+\+RETURN\+\_\+\+ON\+\_\+\+EXCEPTION, v8\+::internal\+::\+Intl\+::\+Canonicalize\+Locale\+List(), v8\+::internal\+::\+Coerce\+Options\+To\+Object(), v8\+::internal\+::\+DCHECK(), v8\+::internal\+::\+Intl\+::\+Resolved\+Locale\+::extensions, v8\+::internal\+::\+Isolate\+::factory(), v8\+::internal\+::\+Managed$<$ Cpp\+Type $>$\+::\+From(), v8\+::\+Maybe$<$ T $>$\+::\+From\+Just(), Get\+Available\+Locales(), v8\+::internal\+::\+Get\+Bool\+Option(), v8\+::internal\+::anonymous\+\_\+namespace\{js-\/collator.\+cc\}\+::\+Get\+Case\+First(), v8\+::internal\+::\+Intl\+::\+Get\+Locale\+Matcher(), v8\+::internal\+::\+Get\+String\+Option(), v8\+::internal\+::\+Intl\+::\+Resolved\+Locale\+::icu\+\_\+locale, v8\+::internal\+::\+JSLocale\+::\+Is38\+Alpha\+Num\+List(), v8\+::internal\+::\+Intl\+::\+Is\+Valid\+Collation(), v8\+::internal\+::anonymous\+\_\+namespace\{isolate.\+cc\}\+::k\+Invalid, v8\+::internal\+::\+Intl\+::\+Resolved\+Locale\+::locale, MAYBE\+\_\+\+RETURN, v8\+::internal\+::\+Factory\+::\+New\+Fast\+Or\+Slow\+JSObject\+From\+Map(), v8\+::internal\+::\+Factory\+Base$<$ Impl $>$\+::\+New\+String\+From\+Ascii\+Checked(), v8\+::internal\+::anonymous\+\_\+namespace\{json-\/stringifier.\+cc\}\+::no\+\_\+gc, v8\+::internal\+::\+Intl\+::\+Resolve\+Locale(), v8\+::internal\+::anonymous\+\_\+namespace\{js-\/collator.\+cc\}\+::\+Set\+Case\+First\+Option(), v8\+::internal\+::anonymous\+\_\+namespace\{js-\/collator.\+cc\}\+::\+Set\+Numeric\+Option(), v8\+::internal\+::status, v8\+::internal\+::string, THROW\+\_\+\+NEW\+\_\+\+ERROR, THROW\+\_\+\+NEW\+\_\+\+ERROR\+\_\+\+RETURN\+\_\+\+VALUE, and v8\+::internal\+::anonymous\+\_\+namespace\{js-\/collator.\+cc\}\+::\+To\+Case\+First().

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=550pt]{classv8_1_1internal_1_1JSCollator_a58b6d3c38c02a21b8c92c7bf1cc3ed98_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classv8_1_1internal_1_1JSCollator_a69d3f92d9db02bf724e0c906a04afa29}\label{classv8_1_1internal_1_1JSCollator_a69d3f92d9db02bf724e0c906a04afa29}} 
\index{v8::internal::JSCollator@{v8::internal::JSCollator}!ResolvedOptions@{ResolvedOptions}}
\index{ResolvedOptions@{ResolvedOptions}!v8::internal::JSCollator@{v8::internal::JSCollator}}
\doxysubsubsection{\texorpdfstring{ResolvedOptions()}{ResolvedOptions()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classv8_1_1internal_1_1DirectHandle}{Direct\+Handle}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1JSObject}{JSObject}} $>$ v8\+::internal\+::\+JSCollator\+::\+Resolved\+Options (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classv8_1_1internal_1_1Isolate}{Isolate}} $\ast$}]{isolate,  }\item[{\mbox{\hyperlink{classv8_1_1internal_1_1DirectHandle}{Direct\+Handle}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1JSCollator}{JSCollator}} $>$}]{collator }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 88 of file js-\/collator.\+cc.


\begin{DoxyCode}{0}
\DoxyCodeLine{89                                                          \{}
\DoxyCodeLine{90   DirectHandle<JSObject> options =}
\DoxyCodeLine{91       isolate-\/>factory()-\/>NewJSObject(isolate-\/>object\_function());}
\DoxyCodeLine{92 }
\DoxyCodeLine{93   icu::Collator* icu\_collator = collator-\/>icu\_collator()-\/>raw();}
\DoxyCodeLine{94   \mbox{\hyperlink{src_2base_2logging_8h_a7b9f9517fedacc2a1a56c2bbb9d03688}{DCHECK\_NOT\_NULL}}(icu\_collator);}
\DoxyCodeLine{95 }
\DoxyCodeLine{96   UErrorCode \mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}} = U\_ZERO\_ERROR;}
\DoxyCodeLine{97   \textcolor{keywordtype}{bool} numeric =}
\DoxyCodeLine{98       icu\_collator-\/>getAttribute(UCOL\_NUMERIC\_COLLATION, \mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}}) == UCOL\_ON;}
\DoxyCodeLine{99   \mbox{\hyperlink{namespacev8_1_1internal_aa6b3743bd5d773c552654f2a6c3efa4a}{DCHECK}}(U\_SUCCESS(\mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}}));}
\DoxyCodeLine{100 }
\DoxyCodeLine{101   \textcolor{keyword}{const} \textcolor{keywordtype}{char}* case\_first = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{102   \mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}} = U\_ZERO\_ERROR;}
\DoxyCodeLine{103   \textcolor{keywordflow}{switch} (icu\_collator-\/>getAttribute(UCOL\_CASE\_FIRST, \mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}})) \{}
\DoxyCodeLine{104     \textcolor{keywordflow}{case} UCOL\_LOWER\_FIRST:}
\DoxyCodeLine{105       case\_first = \textcolor{stringliteral}{"{}lower"{}};}
\DoxyCodeLine{106       \textcolor{keywordflow}{break};}
\DoxyCodeLine{107     \textcolor{keywordflow}{case} UCOL\_UPPER\_FIRST:}
\DoxyCodeLine{108       case\_first = \textcolor{stringliteral}{"{}upper"{}};}
\DoxyCodeLine{109       \textcolor{keywordflow}{break};}
\DoxyCodeLine{110     \textcolor{keywordflow}{default}:}
\DoxyCodeLine{111       case\_first = \textcolor{stringliteral}{"{}false"{}};}
\DoxyCodeLine{112   \}}
\DoxyCodeLine{113   \mbox{\hyperlink{namespacev8_1_1internal_aa6b3743bd5d773c552654f2a6c3efa4a}{DCHECK}}(U\_SUCCESS(\mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}}));}
\DoxyCodeLine{114 }
\DoxyCodeLine{115   \textcolor{keyword}{const} \textcolor{keywordtype}{char}* sensitivity = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{116   \mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}} = U\_ZERO\_ERROR;}
\DoxyCodeLine{117   \textcolor{keywordflow}{switch} (icu\_collator-\/>getAttribute(UCOL\_STRENGTH, \mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}})) \{}
\DoxyCodeLine{118     \textcolor{keywordflow}{case} UCOL\_PRIMARY: \{}
\DoxyCodeLine{119       \mbox{\hyperlink{namespacev8_1_1internal_aa6b3743bd5d773c552654f2a6c3efa4a}{DCHECK}}(U\_SUCCESS(\mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}}));}
\DoxyCodeLine{120       \mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}} = U\_ZERO\_ERROR;}
\DoxyCodeLine{121       \textcolor{comment}{// case level: true + s1 -\/> case, s1 -\/> base.}}
\DoxyCodeLine{122       \textcolor{keywordflow}{if} (UCOL\_ON == icu\_collator-\/>getAttribute(UCOL\_CASE\_LEVEL, \mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}})) \{}
\DoxyCodeLine{123         sensitivity = \textcolor{stringliteral}{"{}case"{}};}
\DoxyCodeLine{124       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{125         sensitivity = \textcolor{stringliteral}{"{}base"{}};}
\DoxyCodeLine{126       \}}
\DoxyCodeLine{127       \mbox{\hyperlink{namespacev8_1_1internal_aa6b3743bd5d773c552654f2a6c3efa4a}{DCHECK}}(U\_SUCCESS(\mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}}));}
\DoxyCodeLine{128       \textcolor{keywordflow}{break};}
\DoxyCodeLine{129     \}}
\DoxyCodeLine{130     \textcolor{keywordflow}{case} UCOL\_SECONDARY:}
\DoxyCodeLine{131       sensitivity = \textcolor{stringliteral}{"{}accent"{}};}
\DoxyCodeLine{132       \textcolor{keywordflow}{break};}
\DoxyCodeLine{133     \textcolor{keywordflow}{case} UCOL\_TERTIARY:}
\DoxyCodeLine{134       sensitivity = \textcolor{stringliteral}{"{}variant"{}};}
\DoxyCodeLine{135       \textcolor{keywordflow}{break};}
\DoxyCodeLine{136     \textcolor{keywordflow}{case} UCOL\_QUATERNARY:}
\DoxyCodeLine{137       \textcolor{comment}{// We shouldn't get quaternary and identical from ICU, but if we do}}
\DoxyCodeLine{138       \textcolor{comment}{// put them into variant.}}
\DoxyCodeLine{139       sensitivity = \textcolor{stringliteral}{"{}variant"{}};}
\DoxyCodeLine{140       \textcolor{keywordflow}{break};}
\DoxyCodeLine{141     \textcolor{keywordflow}{default}:}
\DoxyCodeLine{142       sensitivity = \textcolor{stringliteral}{"{}variant"{}};}
\DoxyCodeLine{143   \}}
\DoxyCodeLine{144   \mbox{\hyperlink{namespacev8_1_1internal_aa6b3743bd5d773c552654f2a6c3efa4a}{DCHECK}}(U\_SUCCESS(\mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}}));}
\DoxyCodeLine{145 }
\DoxyCodeLine{146   \mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}} = U\_ZERO\_ERROR;}
\DoxyCodeLine{147   \textcolor{keywordtype}{bool} ignore\_punctuation = icu\_collator-\/>getAttribute(UCOL\_ALTERNATE\_HANDLING,}
\DoxyCodeLine{148                                                        \mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}}) == UCOL\_SHIFTED;}
\DoxyCodeLine{149   \mbox{\hyperlink{namespacev8_1_1internal_aa6b3743bd5d773c552654f2a6c3efa4a}{DCHECK}}(U\_SUCCESS(\mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}}));}
\DoxyCodeLine{150 }
\DoxyCodeLine{151   \mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}} = U\_ZERO\_ERROR;}
\DoxyCodeLine{152 }
\DoxyCodeLine{153   icu::Locale icu\_locale(icu\_collator-\/>getLocale(ULOC\_VALID\_LOCALE, \mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}}));}
\DoxyCodeLine{154   \mbox{\hyperlink{namespacev8_1_1internal_aa6b3743bd5d773c552654f2a6c3efa4a}{DCHECK}}(U\_SUCCESS(\mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}}));}
\DoxyCodeLine{155 }
\DoxyCodeLine{156   \textcolor{keyword}{const} \textcolor{keywordtype}{char}* collation = \textcolor{stringliteral}{"{}default"{}};}
\DoxyCodeLine{157   \textcolor{keyword}{const} \textcolor{keywordtype}{char}* usage = \textcolor{stringliteral}{"{}sort"{}};}
\DoxyCodeLine{158   \textcolor{keyword}{const} \textcolor{keywordtype}{char}* collation\_key = \textcolor{stringliteral}{"{}co"{}};}
\DoxyCodeLine{159   \mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}} = U\_ZERO\_ERROR;}
\DoxyCodeLine{160   \mbox{\hyperlink{namespacev8_1_1internal_af68b330f02476361ab10f531933b3381}{std::string}} collation\_value =}
\DoxyCodeLine{161       icu\_locale.getUnicodeKeywordValue<\mbox{\hyperlink{namespacev8_1_1internal_af68b330f02476361ab10f531933b3381}{std::string}}>(collation\_key, \mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}});}
\DoxyCodeLine{162 }
\DoxyCodeLine{163   \mbox{\hyperlink{namespacev8_1_1internal_af68b330f02476361ab10f531933b3381}{std::string}} locale;}
\DoxyCodeLine{164   \textcolor{keywordflow}{if} (U\_SUCCESS(\mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}})) \{}
\DoxyCodeLine{165     \textcolor{keywordflow}{if} (collation\_value == \textcolor{stringliteral}{"{}search"{}}) \{}
\DoxyCodeLine{166       usage = \textcolor{stringliteral}{"{}search"{}};}
\DoxyCodeLine{167 }
\DoxyCodeLine{168       \textcolor{comment}{// Search is disallowed as a collation value per spec. Let's}}
\DoxyCodeLine{169       \textcolor{comment}{// use `default`, instead.}}
\DoxyCodeLine{170       \textcolor{comment}{//}}
\DoxyCodeLine{171       \textcolor{comment}{// https://tc39.github.io/ecma402/\#sec-\/properties-\/of-\/intl-\/collator-\/instances}}
\DoxyCodeLine{172       collation = \textcolor{stringliteral}{"{}default"{}};}
\DoxyCodeLine{173 }
\DoxyCodeLine{174       \textcolor{comment}{// We clone the icu::Locale because we don't want the}}
\DoxyCodeLine{175       \textcolor{comment}{// icu\_collator to be affected when we remove the collation key}}
\DoxyCodeLine{176       \textcolor{comment}{// below.}}
\DoxyCodeLine{177       icu::Locale new\_icu\_locale = icu\_locale;}
\DoxyCodeLine{178 }
\DoxyCodeLine{179       \textcolor{comment}{// The spec forbids the search as a collation value in the}}
\DoxyCodeLine{180       \textcolor{comment}{// locale tag, so let's filter it out.}}
\DoxyCodeLine{181       \mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}} = U\_ZERO\_ERROR;}
\DoxyCodeLine{182       new\_icu\_locale.setUnicodeKeywordValue(collation\_key, \textcolor{keyword}{nullptr}, \mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}});}
\DoxyCodeLine{183       \mbox{\hyperlink{namespacev8_1_1internal_aa6b3743bd5d773c552654f2a6c3efa4a}{DCHECK}}(U\_SUCCESS(\mbox{\hyperlink{namespacev8_1_1internal_af04f4104c077ccbaef7596e23816a254}{status}}));}
\DoxyCodeLine{184 }
\DoxyCodeLine{185       locale = \mbox{\hyperlink{classv8_1_1internal_1_1Intl_ab8ac80a3c3afe22c8e3cfd6f9beb33be}{Intl::ToLanguageTag}}(new\_icu\_locale).FromJust();}
\DoxyCodeLine{186     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{187       collation = collation\_value.c\_str();}
\DoxyCodeLine{188       locale = \mbox{\hyperlink{classv8_1_1internal_1_1Intl_ab8ac80a3c3afe22c8e3cfd6f9beb33be}{Intl::ToLanguageTag}}(icu\_locale).FromJust();}
\DoxyCodeLine{189     \}}
\DoxyCodeLine{190   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{191     locale = \mbox{\hyperlink{classv8_1_1internal_1_1Intl_ab8ac80a3c3afe22c8e3cfd6f9beb33be}{Intl::ToLanguageTag}}(icu\_locale).FromJust();}
\DoxyCodeLine{192   \}}
\DoxyCodeLine{193 }
\DoxyCodeLine{194   \textcolor{comment}{// 5. For each row of Table 2, except the header row, in table order, do}}
\DoxyCodeLine{195   \textcolor{comment}{//    ...}}
\DoxyCodeLine{196   \textcolor{comment}{// Table 2: Resolved Options of Collator Instances}}
\DoxyCodeLine{197   \textcolor{comment}{//  Internal Slot            Property               Extension Key}}
\DoxyCodeLine{198   \textcolor{comment}{//    [[Locale]                "{}locale"{}}}
\DoxyCodeLine{199   \textcolor{comment}{//    [[Usage]                 "{}usage"{}}}
\DoxyCodeLine{200   \textcolor{comment}{//    [[Sensitivity]]          "{}sensitivity"{}}}
\DoxyCodeLine{201   \textcolor{comment}{//    [[IgnorePunctuation]]    "{}ignorePunctuation"{}}}
\DoxyCodeLine{202   \textcolor{comment}{//    [[Collation]]            "{}collation"{}}}
\DoxyCodeLine{203   \textcolor{comment}{//    [[Numeric]]              "{}numeric"{}              kn}}
\DoxyCodeLine{204   \textcolor{comment}{//    [[CaseFirst]]            "{}caseFirst"{}            kf}}
\DoxyCodeLine{205 }
\DoxyCodeLine{206   \textcolor{comment}{// If the collator return the locale differ from what got requested, we stored}}
\DoxyCodeLine{207   \textcolor{comment}{// it in the collator-\/>locale. Otherwise, we just use the one from the}}
\DoxyCodeLine{208   \textcolor{comment}{// collator.}}
\DoxyCodeLine{209   \textcolor{keywordflow}{if} (collator-\/>locale()-\/>length() != 0) \{}
\DoxyCodeLine{210     \textcolor{comment}{// Get the locale from collator-\/>locale() since we know in some cases}}
\DoxyCodeLine{211     \textcolor{comment}{// collator won't be able to return the requested one, such as zh\_CN.}}
\DoxyCodeLine{212     DirectHandle<String> locale\_from\_collator(collator-\/>locale(), isolate);}
\DoxyCodeLine{213     Maybe<bool> maybe = \mbox{\hyperlink{classv8_1_1internal_1_1JSReceiver_ab0d496ab5c687ec63fed2abbc354df25}{JSReceiver::CreateDataProperty}}(}
\DoxyCodeLine{214         isolate, options, isolate-\/>factory()-\/>locale\_string(),}
\DoxyCodeLine{215         locale\_from\_collator, \mbox{\hyperlink{namespacev8_a41f0e280eadfba6ac9afd833fdd540cf}{Just}}(\mbox{\hyperlink{namespacev8_1_1internal_adbf2c933630f2f4bb419ce1ba04ce760a4b0c7b00af69f6f81914acaa3a9849ee}{kDontThrow}}));}
\DoxyCodeLine{216     \mbox{\hyperlink{namespacev8_1_1internal_aa6b3743bd5d773c552654f2a6c3efa4a}{DCHECK}}(maybe.FromJust());}
\DoxyCodeLine{217     \mbox{\hyperlink{src_2base_2macros_8h_a280b0798f270f4b3f361c9ab64832956}{USE}}(maybe);}
\DoxyCodeLine{218   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{219     \textcolor{comment}{// Just return from the collator for most of the cases that we can recover}}
\DoxyCodeLine{220     \textcolor{comment}{// from the collator.}}
\DoxyCodeLine{221     \mbox{\hyperlink{namespacev8_1_1internal_1_1anonymous__namespace_02js-collator_8cc_03_a66f180ef0417836c4f0260e19b18f7ee}{CreateDataPropertyForOptions}}(}
\DoxyCodeLine{222         isolate, options, isolate-\/>factory()-\/>locale\_string(), locale.c\_str());}
\DoxyCodeLine{223   \}}
\DoxyCodeLine{224 }
\DoxyCodeLine{225   \mbox{\hyperlink{namespacev8_1_1internal_1_1anonymous__namespace_02js-collator_8cc_03_a66f180ef0417836c4f0260e19b18f7ee}{CreateDataPropertyForOptions}}(isolate, options,}
\DoxyCodeLine{226                                isolate-\/>factory()-\/>usage\_string(), usage);}
\DoxyCodeLine{227   \mbox{\hyperlink{namespacev8_1_1internal_1_1anonymous__namespace_02js-collator_8cc_03_a66f180ef0417836c4f0260e19b18f7ee}{CreateDataPropertyForOptions}}(}
\DoxyCodeLine{228       isolate, options, isolate-\/>factory()-\/>sensitivity\_string(), sensitivity);}
\DoxyCodeLine{229   \mbox{\hyperlink{namespacev8_1_1internal_1_1anonymous__namespace_02js-collator_8cc_03_a66f180ef0417836c4f0260e19b18f7ee}{CreateDataPropertyForOptions}}(isolate, options,}
\DoxyCodeLine{230                                isolate-\/>factory()-\/>ignorePunctuation\_string(),}
\DoxyCodeLine{231                                ignore\_punctuation);}
\DoxyCodeLine{232   \mbox{\hyperlink{namespacev8_1_1internal_1_1anonymous__namespace_02js-collator_8cc_03_a66f180ef0417836c4f0260e19b18f7ee}{CreateDataPropertyForOptions}}(}
\DoxyCodeLine{233       isolate, options, isolate-\/>factory()-\/>collation\_string(), collation);}
\DoxyCodeLine{234   \mbox{\hyperlink{namespacev8_1_1internal_1_1anonymous__namespace_02js-collator_8cc_03_a66f180ef0417836c4f0260e19b18f7ee}{CreateDataPropertyForOptions}}(isolate, options,}
\DoxyCodeLine{235                                isolate-\/>factory()-\/>numeric\_string(), numeric);}
\DoxyCodeLine{236   \mbox{\hyperlink{namespacev8_1_1internal_1_1anonymous__namespace_02js-collator_8cc_03_a66f180ef0417836c4f0260e19b18f7ee}{CreateDataPropertyForOptions}}(}
\DoxyCodeLine{237       isolate, options, isolate-\/>factory()-\/>caseFirst\_string(), case\_first);}
\DoxyCodeLine{238   \textcolor{keywordflow}{return} options;}
\DoxyCodeLine{239 \}}

\end{DoxyCode}


References v8\+::internal\+::\+JSReceiver\+::\+Create\+Data\+Property(), v8\+::internal\+::anonymous\+\_\+namespace\{js-\/collator.\+cc\}\+::\+Create\+Data\+Property\+For\+Options(), v8\+::internal\+::\+DCHECK(), DCHECK\+\_\+\+NOT\+\_\+\+NULL, v8\+::internal\+::\+Isolate\+::factory(), v8\+::\+Maybe$<$ T $>$\+::\+From\+Just(), v8\+::\+Just(), v8\+::internal\+::k\+Dont\+Throw, v8\+::internal\+::\+Factory\+::\+New\+JSObject(), v8\+::internal\+::status, v8\+::internal\+::string, v8\+::internal\+::\+Intl\+::\+To\+Language\+Tag(), and USE.



Referenced by v8\+::internal\+::\+BUILTIN().

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classv8_1_1internal_1_1JSCollator_a69d3f92d9db02bf724e0c906a04afa29_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classv8_1_1internal_1_1JSCollator_a69d3f92d9db02bf724e0c906a04afa29_icgraph}
\end{center}
\end{figure}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
/mnt/\+V8\+Source\+Code/src/objects/\mbox{\hyperlink{js-collator_8h}{js-\/collator.\+h}}\item 
/mnt/\+V8\+Source\+Code/src/objects/\mbox{\hyperlink{js-collator_8cc}{js-\/collator.\+cc}}\end{DoxyCompactItemize}
