\hypertarget{classv8_1_1internal_1_1JSAtomicsCondition}{}\doxysection{v8\+::internal\+::JSAtomics\+Condition Class Reference}
\label{classv8_1_1internal_1_1JSAtomicsCondition}\index{v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}}


{\ttfamily \#include $<$js-\/atomics-\/synchronization.\+h$>$}



Inheritance diagram for v8\+::internal\+::JSAtomics\+Condition\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=266pt]{classv8_1_1internal_1_1JSAtomicsCondition__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for v8\+::internal\+::JSAtomics\+Condition\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=341pt]{classv8_1_1internal_1_1JSAtomicsCondition__coll__graph}
\end{center}
\end{figure}
\doxysubsection*{Public Types}
\begin{DoxyCompactItemize}
\item 
enum \{ \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_a52db506cdcf0855042f99540cbd239b0a1dd6cb256d96770ef2df784e8124d0ab}{k\+Mutex\+Async\+Context\+Slot}} = Context\+::MIN\+\_\+\+CONTEXT\+\_\+\+SLOTS
, \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_a52db506cdcf0855042f99540cbd239b0ab53a7c551e9fac0a1718c829d1450b73}{k\+Condition\+Variable\+Async\+Context\+Slot}}
, \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_a52db506cdcf0855042f99540cbd239b0a764f0bf2ad34211e2f7f07c2dde3d8f7}{k\+Async\+Context\+Length}}
 \}
\item 
using \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_a0ce4c81b84cf4ca15cc17f330d760cdc}{Async\+Waiter\+Node\+Type}} = \mbox{\hyperlink{namespacev8_1_1internal_a2f74056d959689b951d0d45ce2fe9dfe}{Wait\+Async\+Waiter\+Queue\+Node}}
\end{DoxyCompactItemize}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{src_2base_2macros_8h_ab08e353943a53678ac6baafc678f2d81}{V8\+\_\+\+EXPORT\+\_\+\+PRIVATE}} \mbox{\hyperlink{namespacev8_1_1internal_a4e2118a7c0d730210e0cb87b511cba70}{bool}} \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_af9e08e07218a45361ad3e9e3a27cf15a}{Wait\+For}} (\mbox{\hyperlink{classv8_1_1internal_1_1Isolate}{Isolate}} $\ast$requester, \mbox{\hyperlink{classv8_1_1internal_1_1DirectHandle}{Direct\+Handle}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition}{JSAtomics\+Condition}} $>$ cv, \mbox{\hyperlink{classv8_1_1internal_1_1DirectHandle}{Direct\+Handle}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsMutex}{JSAtomics\+Mutex}} $>$ mutex, std\+::optional$<$ \mbox{\hyperlink{classv8_1_1base_1_1TimeDelta}{base\+::\+Time\+Delta}} $>$ timeout)
\item 
static \mbox{\hyperlink{src_2base_2macros_8h_ab08e353943a53678ac6baafc678f2d81}{V8\+\_\+\+EXPORT\+\_\+\+PRIVATE}} \mbox{\hyperlink{classv8_1_1internal_1_1MaybeDirectHandle}{Maybe\+Direct\+Handle}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1JSReceiver}{JSReceiver}} $>$ \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_a0a626b72e905bbeccb72b5f15d9bafbb}{Wait\+Async}} (\mbox{\hyperlink{classv8_1_1internal_1_1Isolate}{Isolate}} $\ast$requester, \mbox{\hyperlink{classv8_1_1internal_1_1DirectHandle}{Direct\+Handle}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition}{JSAtomics\+Condition}} $>$ cv, \mbox{\hyperlink{classv8_1_1internal_1_1DirectHandle}{Direct\+Handle}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsMutex}{JSAtomics\+Mutex}} $>$ mutex, std\+::optional$<$ \mbox{\hyperlink{classv8_1_1base_1_1TimeDelta}{base\+::\+Time\+Delta}} $>$ timeout)
\item 
static void \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_a8080e9285ba0fe037c19e3ae9ebcfb1c}{Handle\+Async\+Notify}} (\mbox{\hyperlink{namespacev8_1_1internal_a2f74056d959689b951d0d45ce2fe9dfe}{Wait\+Async\+Waiter\+Queue\+Node}} $\ast$node)
\item 
static void \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_ac64fec0a6cc4d23c2cb63e4ba80f72cd}{Handle\+Async\+Timeout}} (\mbox{\hyperlink{namespacev8_1_1internal_a2f74056d959689b951d0d45ce2fe9dfe}{Wait\+Async\+Waiter\+Queue\+Node}} $\ast$node)
\item 
static \mbox{\hyperlink{src_2base_2macros_8h_ab08e353943a53678ac6baafc678f2d81}{V8\+\_\+\+EXPORT\+\_\+\+PRIVATE}} uint32\+\_\+t \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_ae6324d997082736b35e9aef9a3243dcd}{Notify}} (\mbox{\hyperlink{classv8_1_1internal_1_1Isolate}{Isolate}} $\ast$requester, \mbox{\hyperlink{classv8_1_1internal_1_1DirectHandle}{Direct\+Handle}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition}{JSAtomics\+Condition}} $>$ cv, uint32\+\_\+t \mbox{\hyperlink{structv8_1_1internal_1_1count}{count}})
\item 
static void \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_ab4f19096b07f910048e717ad625b233a}{Cleanup\+Matching\+Async\+Waiters}} (\mbox{\hyperlink{classv8_1_1internal_1_1Isolate}{Isolate}} $\ast$isolate, \mbox{\hyperlink{classv8_1_1internal_1_1detail_1_1WaiterQueueNode}{Waiter\+Queue\+Node}} $\ast$node, Dequeue\+Matcher matcher)
\end{DoxyCompactItemize}
\doxysubsection*{Static Public Attributes}
\begin{DoxyCompactItemize}
\item 
static constexpr uint32\+\_\+t \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_aae1f923bd44e58174430c354950d5b32}{k\+All\+Waiters}} = UINT32\+\_\+\+MAX
\end{DoxyCompactItemize}
\doxysubsection*{Private Types}
\begin{DoxyCompactItemize}
\item 
using \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_a8a13ba5e71e18f7754b31df01b952098}{Dequeue\+Action}} = std\+::function$<$ uint32\+\_\+t(\mbox{\hyperlink{classv8_1_1internal_1_1detail_1_1WaiterQueueNode}{Waiter\+Queue\+Node}} $\ast$$\ast$)$>$
\end{DoxyCompactItemize}
\doxysubsection*{Static Private Member Functions}
\begin{DoxyCompactItemize}
\item 
static void \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_a51f385dcf4789296cf3021d2e6f520c5}{Queue\+Waiter}} (\mbox{\hyperlink{classv8_1_1internal_1_1Isolate}{Isolate}} $\ast$requester, \mbox{\hyperlink{classv8_1_1internal_1_1DirectHandle}{Direct\+Handle}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition}{JSAtomics\+Condition}} $>$ cv, \mbox{\hyperlink{classv8_1_1internal_1_1detail_1_1WaiterQueueNode}{Waiter\+Queue\+Node}} $\ast$waiter)
\item 
static uint32\+\_\+t \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_a78ddcc4925d1be48d26a3893d650ee08}{Dequeue\+Explicit}} (\mbox{\hyperlink{classv8_1_1internal_1_1Isolate}{Isolate}} $\ast$requester, \mbox{\hyperlink{classv8_1_1internal_1_1DirectHandle}{Direct\+Handle}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition}{JSAtomics\+Condition}} $>$ cv, std\+::atomic$<$ StateT $>$ $\ast$state, const \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_a8a13ba5e71e18f7754b31df01b952098}{Dequeue\+Action}} \&dequeue\+\_\+action)
\end{DoxyCompactItemize}
\doxysubsection*{Friends}
\begin{DoxyCompactItemize}
\item 
class \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_a328c093d609680cca505905c6d49901a}{Factory}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


Definition at line 400 of file js-\/atomics-\/synchronization.\+h.



\doxysubsection{Member Typedef Documentation}
\mbox{\Hypertarget{classv8_1_1internal_1_1JSAtomicsCondition_a0ce4c81b84cf4ca15cc17f330d760cdc}\label{classv8_1_1internal_1_1JSAtomicsCondition_a0ce4c81b84cf4ca15cc17f330d760cdc}} 
\index{v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}!AsyncWaiterNodeType@{AsyncWaiterNodeType}}
\index{AsyncWaiterNodeType@{AsyncWaiterNodeType}!v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}}
\doxysubsubsection{\texorpdfstring{AsyncWaiterNodeType}{AsyncWaiterNodeType}}
{\footnotesize\ttfamily using \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_a0ce4c81b84cf4ca15cc17f330d760cdc}{v8\+::internal\+::\+JSAtomics\+Condition\+::\+Async\+Waiter\+Node\+Type}} =  \mbox{\hyperlink{namespacev8_1_1internal_a2f74056d959689b951d0d45ce2fe9dfe}{Wait\+Async\+Waiter\+Queue\+Node}}}



Definition at line 404 of file js-\/atomics-\/synchronization.\+h.

\mbox{\Hypertarget{classv8_1_1internal_1_1JSAtomicsCondition_a8a13ba5e71e18f7754b31df01b952098}\label{classv8_1_1internal_1_1JSAtomicsCondition_a8a13ba5e71e18f7754b31df01b952098}} 
\index{v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}!DequeueAction@{DequeueAction}}
\index{DequeueAction@{DequeueAction}!v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}}
\doxysubsubsection{\texorpdfstring{DequeueAction}{DequeueAction}}
{\footnotesize\ttfamily using \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_a8a13ba5e71e18f7754b31df01b952098}{v8\+::internal\+::\+JSAtomics\+Condition\+::\+Dequeue\+Action}} =  std\+::function$<$uint32\+\_\+t(\mbox{\hyperlink{classv8_1_1internal_1_1detail_1_1WaiterQueueNode}{Waiter\+Queue\+Node}}$\ast$$\ast$)$>$\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 447 of file js-\/atomics-\/synchronization.\+h.



\doxysubsection{Member Enumeration Documentation}
\mbox{\Hypertarget{classv8_1_1internal_1_1JSAtomicsCondition_a52db506cdcf0855042f99540cbd239b0}\label{classv8_1_1internal_1_1JSAtomicsCondition_a52db506cdcf0855042f99540cbd239b0}} 
\doxysubsubsection{\texorpdfstring{anonymous enum}{anonymous enum}}
{\footnotesize\ttfamily anonymous enum}

\begin{DoxyEnumFields}{Enumerator}
\raisebox{\heightof{T}}[0pt][0pt]{\index{kMutexAsyncContextSlot@{kMutexAsyncContextSlot}!v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}}\index{v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}!kMutexAsyncContextSlot@{kMutexAsyncContextSlot}}}\mbox{\Hypertarget{classv8_1_1internal_1_1JSAtomicsCondition_a52db506cdcf0855042f99540cbd239b0a1dd6cb256d96770ef2df784e8124d0ab}\label{classv8_1_1internal_1_1JSAtomicsCondition_a52db506cdcf0855042f99540cbd239b0a1dd6cb256d96770ef2df784e8124d0ab}} 
k\+Mutex\+Async\+Context\+Slot&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{kConditionVariableAsyncContextSlot@{kConditionVariableAsyncContextSlot}!v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}}\index{v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}!kConditionVariableAsyncContextSlot@{kConditionVariableAsyncContextSlot}}}\mbox{\Hypertarget{classv8_1_1internal_1_1JSAtomicsCondition_a52db506cdcf0855042f99540cbd239b0ab53a7c551e9fac0a1718c829d1450b73}\label{classv8_1_1internal_1_1JSAtomicsCondition_a52db506cdcf0855042f99540cbd239b0ab53a7c551e9fac0a1718c829d1450b73}} 
k\+Condition\+Variable\+Async\+Context\+Slot&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{kAsyncContextLength@{kAsyncContextLength}!v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}}\index{v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}!kAsyncContextLength@{kAsyncContextLength}}}\mbox{\Hypertarget{classv8_1_1internal_1_1JSAtomicsCondition_a52db506cdcf0855042f99540cbd239b0a764f0bf2ad34211e2f7f07c2dde3d8f7}\label{classv8_1_1internal_1_1JSAtomicsCondition_a52db506cdcf0855042f99540cbd239b0a764f0bf2ad34211e2f7f07c2dde3d8f7}} 
k\+Async\+Context\+Length&\\
\hline

\end{DoxyEnumFields}


Definition at line 432 of file js-\/atomics-\/synchronization.\+h.


\begin{DoxyCode}{0}
\DoxyCodeLine{432        \{}
\DoxyCodeLine{433     \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_a52db506cdcf0855042f99540cbd239b0a1dd6cb256d96770ef2df784e8124d0ab}{kMutexAsyncContextSlot}} = \mbox{\hyperlink{classv8_1_1internal_1_1Context_a7a43120c7c95a95be912a46217274266a259e7927638db515902b439e5c4ec513}{Context::MIN\_CONTEXT\_SLOTS}},}
\DoxyCodeLine{434     \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_a52db506cdcf0855042f99540cbd239b0ab53a7c551e9fac0a1718c829d1450b73}{kConditionVariableAsyncContextSlot}},}
\DoxyCodeLine{435     \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_a52db506cdcf0855042f99540cbd239b0a764f0bf2ad34211e2f7f07c2dde3d8f7}{kAsyncContextLength}}}
\DoxyCodeLine{436   \};}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classv8_1_1internal_1_1JSAtomicsCondition_ab4f19096b07f910048e717ad625b233a}\label{classv8_1_1internal_1_1JSAtomicsCondition_ab4f19096b07f910048e717ad625b233a}} 
\index{v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}!CleanupMatchingAsyncWaiters@{CleanupMatchingAsyncWaiters}}
\index{CleanupMatchingAsyncWaiters@{CleanupMatchingAsyncWaiters}!v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}}
\doxysubsubsection{\texorpdfstring{CleanupMatchingAsyncWaiters()}{CleanupMatchingAsyncWaiters()}}
{\footnotesize\ttfamily void v8\+::internal\+::\+JSAtomics\+Condition\+::\+Cleanup\+Matching\+Async\+Waiters (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classv8_1_1internal_1_1Isolate}{Isolate}} $\ast$}]{isolate,  }\item[{\mbox{\hyperlink{classv8_1_1internal_1_1detail_1_1WaiterQueueNode}{Waiter\+Queue\+Node}} $\ast$}]{node,  }\item[{Dequeue\+Matcher}]{matcher }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 1121 of file js-\/atomics-\/synchronization.\+cc.


\begin{DoxyCode}{0}
\DoxyCodeLine{1123                                                                              \{}
\DoxyCodeLine{1124   \textcolor{keyword}{auto}* async\_node = \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{namespacev8_1_1internal_a2f74056d959689b951d0d45ce2fe9dfe}{WaitAsyncWaiterQueueNode}}*\textcolor{keyword}{>}(node);}
\DoxyCodeLine{1125   \textcolor{keywordflow}{if} (async\_node-\/>ready\_for\_async\_cleanup\_) \{}
\DoxyCodeLine{1126     \textcolor{comment}{// The node is not in the waiter queue and there is no HandleNotify task}}
\DoxyCodeLine{1127     \textcolor{comment}{// for it in the event loop. So it is safe to delete it.}}
\DoxyCodeLine{1128     \textcolor{keywordflow}{return};}
\DoxyCodeLine{1129   \}}
\DoxyCodeLine{1130   \textcolor{keywordflow}{if} (async\_node-\/>IsEmpty()) \{}
\DoxyCodeLine{1131     \textcolor{comment}{// The node's underlying synchronization primitive has been collected, so}}
\DoxyCodeLine{1132     \textcolor{comment}{// delete it.}}
\DoxyCodeLine{1133     async\_node-\/>SetNotInListForVerification();}
\DoxyCodeLine{1134     \textcolor{keywordflow}{return};}
\DoxyCodeLine{1135   \}}
\DoxyCodeLine{1136   DirectHandle<JSAtomicsCondition> cv =}
\DoxyCodeLine{1137       async\_node-\/>GetSynchronizationPrimitive();}
\DoxyCodeLine{1138   std::atomic<StateT>* state = cv-\/>AtomicStatePtr();}
\DoxyCodeLine{1139   StateT current\_state = state-\/>load(std::memory\_order\_relaxed);}
\DoxyCodeLine{1140 }
\DoxyCodeLine{1141   WaiterQueueLockGuard waiter\_queue\_lock\_guard(state, current\_state);}
\DoxyCodeLine{1142 }
\DoxyCodeLine{1143   WaiterQueueNode* waiter\_head = cv-\/>DestructivelyGetWaiterQueueHead(isolate);}
\DoxyCodeLine{1144   \textcolor{keywordflow}{if} (waiter\_head) \{}
\DoxyCodeLine{1145     \mbox{\hyperlink{classv8_1_1internal_1_1detail_1_1WaiterQueueNode_a0cae6ce82fdd7c88fe431afa22093868}{WaiterQueueNode::DequeueAllMatchingForAsyncCleanup}}(\&waiter\_head, matcher);}
\DoxyCodeLine{1146   \}}
\DoxyCodeLine{1147   StateT new\_state =}
\DoxyCodeLine{1148       cv-\/>SetWaiterQueueHead(isolate, waiter\_head, current\_state);}
\DoxyCodeLine{1149   waiter\_queue\_lock\_guard.set\_new\_state(new\_state);}
\DoxyCodeLine{1150 \}}

\end{DoxyCode}


References v8\+::internal\+::detail\+::\+Waiter\+Queue\+Node\+::\+Dequeue\+All\+Matching\+For\+Async\+Cleanup(), v8\+::internal\+::detail\+::\+Waiter\+Queue\+Lock\+Guard\+::set\+\_\+new\+\_\+state(), and v8\+::internal\+::detail\+::\+Waiter\+Queue\+Node\+::\+Set\+Not\+In\+List\+For\+Verification().

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classv8_1_1internal_1_1JSAtomicsCondition_ab4f19096b07f910048e717ad625b233a_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classv8_1_1internal_1_1JSAtomicsCondition_a78ddcc4925d1be48d26a3893d650ee08}\label{classv8_1_1internal_1_1JSAtomicsCondition_a78ddcc4925d1be48d26a3893d650ee08}} 
\index{v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}!DequeueExplicit@{DequeueExplicit}}
\index{DequeueExplicit@{DequeueExplicit}!v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}}
\doxysubsubsection{\texorpdfstring{DequeueExplicit()}{DequeueExplicit()}}
{\footnotesize\ttfamily uint32\+\_\+t v8\+::internal\+::\+JSAtomics\+Condition\+::\+Dequeue\+Explicit (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classv8_1_1internal_1_1Isolate}{Isolate}} $\ast$}]{requester,  }\item[{\mbox{\hyperlink{classv8_1_1internal_1_1DirectHandle}{Direct\+Handle}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition}{JSAtomics\+Condition}} $>$}]{cv,  }\item[{std\+::atomic$<$ StateT $>$ $\ast$}]{state,  }\item[{const \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_a8a13ba5e71e18f7754b31df01b952098}{Dequeue\+Action}} \&}]{dequeue\+\_\+action }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [private]}}



Definition at line 1218 of file js-\/atomics-\/synchronization.\+cc.


\begin{DoxyCode}{0}
\DoxyCodeLine{1220                                                                       \{}
\DoxyCodeLine{1221   \textcolor{comment}{// First acquire the queue lock, which is itself a spinlock.}}
\DoxyCodeLine{1222   StateT current\_state = state-\/>load(std::memory\_order\_relaxed);}
\DoxyCodeLine{1223 }
\DoxyCodeLine{1224   \textcolor{keywordflow}{if} (!HasWaitersField::decode(current\_state)) \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{1225   WaiterQueueLockGuard waiter\_queue\_lock\_guard(state, current\_state);}
\DoxyCodeLine{1226 }
\DoxyCodeLine{1227   \textcolor{comment}{// Get the waiter queue head.}}
\DoxyCodeLine{1228   WaiterQueueNode* waiter\_head = cv-\/>DestructivelyGetWaiterQueueHead(requester);}
\DoxyCodeLine{1229 }
\DoxyCodeLine{1230   \textcolor{comment}{// There's no waiter to wake up, release the queue lock by setting it to the}}
\DoxyCodeLine{1231   \textcolor{comment}{// empty state.}}
\DoxyCodeLine{1232   \textcolor{keywordflow}{if} (waiter\_head == \textcolor{keyword}{nullptr}) \{}
\DoxyCodeLine{1233     StateT new\_state = kEmptyState;}
\DoxyCodeLine{1234     waiter\_queue\_lock\_guard.set\_new\_state(new\_state);}
\DoxyCodeLine{1235     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{1236   \}}
\DoxyCodeLine{1237 }
\DoxyCodeLine{1238   uint32\_t num\_dequeued\_waiters = action\_under\_lock(\&waiter\_head);}
\DoxyCodeLine{1239 }
\DoxyCodeLine{1240   \textcolor{comment}{// Release the queue lock and install the new waiter queue head.}}
\DoxyCodeLine{1241   \mbox{\hyperlink{src_2base_2logging_8h_af9c313d74155f7f201955a939e24c71f}{DCHECK\_EQ}}(state-\/>load(),}
\DoxyCodeLine{1242             IsWaiterQueueLockedField::update(current\_state, \textcolor{keyword}{true}));}
\DoxyCodeLine{1243   StateT new\_state =}
\DoxyCodeLine{1244       cv-\/>SetWaiterQueueHead(requester, waiter\_head, current\_state);}
\DoxyCodeLine{1245   waiter\_queue\_lock\_guard.set\_new\_state(new\_state);}
\DoxyCodeLine{1246 }
\DoxyCodeLine{1247   \textcolor{keywordflow}{return} num\_dequeued\_waiters;}
\DoxyCodeLine{1248 \}}

\end{DoxyCode}


References DCHECK\+\_\+\+EQ, and v8\+::internal\+::detail\+::\+Waiter\+Queue\+Lock\+Guard\+::set\+\_\+new\+\_\+state().



Referenced by Handle\+Async\+Timeout(), Notify(), and Wait\+For().

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classv8_1_1internal_1_1JSAtomicsCondition_a78ddcc4925d1be48d26a3893d650ee08_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classv8_1_1internal_1_1JSAtomicsCondition_a78ddcc4925d1be48d26a3893d650ee08_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classv8_1_1internal_1_1JSAtomicsCondition_a8080e9285ba0fe037c19e3ae9ebcfb1c}\label{classv8_1_1internal_1_1JSAtomicsCondition_a8080e9285ba0fe037c19e3ae9ebcfb1c}} 
\index{v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}!HandleAsyncNotify@{HandleAsyncNotify}}
\index{HandleAsyncNotify@{HandleAsyncNotify}!v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}}
\doxysubsubsection{\texorpdfstring{HandleAsyncNotify()}{HandleAsyncNotify()}}
{\footnotesize\ttfamily void v8\+::internal\+::\+JSAtomics\+Condition\+::\+Handle\+Async\+Notify (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacev8_1_1internal_a2f74056d959689b951d0d45ce2fe9dfe}{Wait\+Async\+Waiter\+Queue\+Node}} $\ast$}]{node }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 1367 of file js-\/atomics-\/synchronization.\+cc.


\begin{DoxyCode}{0}
\DoxyCodeLine{1367                                                                            \{}
\DoxyCodeLine{1368   Isolate* requester = waiter-\/>requester\_;}
\DoxyCodeLine{1369   \textcolor{keywordflow}{if} (\mbox{\hyperlink{v8config_8h_a67bd29db07c711b0fb11ff1c324ebb60}{V8\_UNLIKELY}}(waiter-\/>native\_context\_.IsEmpty())) \{}
\DoxyCodeLine{1370     \textcolor{comment}{// The native context was destroyed so the promise was already removed}}
\DoxyCodeLine{1371     \textcolor{comment}{// from the native context. Remove the node from the async unlocked waiter}}
\DoxyCodeLine{1372     \textcolor{comment}{// list.}}
\DoxyCodeLine{1373     \mbox{\hyperlink{classv8_1_1internal_1_1detail_1_1AsyncWaiterQueueNode_a52115608b23a4b7d2d5e8fd0ffffa1d0}{WaitAsyncWaiterQueueNode::RemoveFromAsyncWaiterQueueList}}(waiter);}
\DoxyCodeLine{1374     \textcolor{keywordflow}{return};}
\DoxyCodeLine{1375   \}}
\DoxyCodeLine{1376   HandleScope scope(requester);}
\DoxyCodeLine{1377   \textcolor{keywordflow}{if} (waiter-\/>timeout\_task\_id\_ != \mbox{\hyperlink{classv8_1_1internal_1_1CancelableTaskManager_aeced01d51e2e17fe43f5286404519146}{CancelableTaskManager::kInvalidTaskId}}) \{}
\DoxyCodeLine{1378     \mbox{\hyperlink{namespacev8_1_1internal_a4a7a0d7631497f73ac7e69b8cfd67a66}{TryAbortResult}} abort\_result =}
\DoxyCodeLine{1379         requester-\/>cancelable\_task\_manager()-\/>TryAbort(}
\DoxyCodeLine{1380             waiter-\/>timeout\_task\_id\_);}
\DoxyCodeLine{1381     \mbox{\hyperlink{src_2base_2logging_8h_af9c313d74155f7f201955a939e24c71f}{DCHECK\_EQ}}(abort\_result, \mbox{\hyperlink{namespacev8_1_1internal_a4a7a0d7631497f73ac7e69b8cfd67a66ac6e752bc3177d9fc3f0c9bc51604d37f}{TryAbortResult::kTaskAborted}});}
\DoxyCodeLine{1382     \mbox{\hyperlink{src_2base_2macros_8h_a280b0798f270f4b3f361c9ab64832956}{USE}}(abort\_result);}
\DoxyCodeLine{1383   \}}
\DoxyCodeLine{1384   \mbox{\hyperlink{classv8_1_1Context_1_1Scope}{v8::Context::Scope}} contextScope(waiter-\/>GetNativeContext());}
\DoxyCodeLine{1385   DirectHandle<JSPromise> promise = waiter-\/>GetInternalWaitingPromise();}
\DoxyCodeLine{1386   MaybeDirectHandle<Object> \mbox{\hyperlink{namespacev8_1_1base_1_1internal_a9840f2bf0b4780133662292486d0bc01}{result}} =}
\DoxyCodeLine{1387       \mbox{\hyperlink{classv8_1_1internal_1_1JSPromise_ab5498a7e4026703f904ad2ab3018c250}{JSPromise::Resolve}}(promise, requester-\/>factory()-\/>undefined\_value());}
\DoxyCodeLine{1388   \mbox{\hyperlink{src_2base_2macros_8h_a280b0798f270f4b3f361c9ab64832956}{USE}}(\mbox{\hyperlink{namespacev8_1_1base_1_1internal_a9840f2bf0b4780133662292486d0bc01}{result}});}
\DoxyCodeLine{1389   \mbox{\hyperlink{classv8_1_1internal_1_1detail_1_1AsyncWaiterQueueNode_a52115608b23a4b7d2d5e8fd0ffffa1d0}{WaitAsyncWaiterQueueNode::RemoveFromAsyncWaiterQueueList}}(waiter);}
\DoxyCodeLine{1390   \mbox{\hyperlink{namespacev8_1_1internal_1_1anonymous__namespace_02js-atomics-synchronization_8cc_03_adb32c9fd08754d52ac771254297ecd44}{RemovePromiseFromNativeContext}}(requester, promise);}
\DoxyCodeLine{1391 \}}

\end{DoxyCode}


References v8\+::internal\+::\+Isolate\+::cancelable\+\_\+task\+\_\+manager(), DCHECK\+\_\+\+EQ, v8\+::internal\+::\+Isolate\+::factory(), v8\+::internal\+::detail\+::\+Async\+Waiter\+Queue\+Node$<$ T $>$\+::\+Get\+Internal\+Waiting\+Promise(), v8\+::internal\+::detail\+::\+Async\+Waiter\+Queue\+Node$<$ T $>$\+::\+Get\+Native\+Context(), v8\+::api\+\_\+internal\+::\+Indirect\+Handle\+Base\+::\+Is\+Empty(), v8\+::internal\+::\+Cancelable\+Task\+Manager\+::k\+Invalid\+Task\+Id, v8\+::internal\+::k\+Task\+Aborted, v8\+::internal\+::detail\+::\+Async\+Waiter\+Queue\+Node$<$ T $>$\+::native\+\_\+context\+\_\+, v8\+::internal\+::detail\+::\+Async\+Waiter\+Queue\+Node$<$ T $>$\+::\+Remove\+From\+Async\+Waiter\+Queue\+List(), v8\+::internal\+::anonymous\+\_\+namespace\{js-\/atomics-\/synchronization.\+cc\}\+::\+Remove\+Promise\+From\+Native\+Context(), v8\+::internal\+::detail\+::\+Waiter\+Queue\+Node\+::requester\+\_\+, v8\+::internal\+::\+JSPromise\+::\+Resolve(), v8\+::base\+::internal\+::result, v8\+::internal\+::detail\+::\+Async\+Waiter\+Queue\+Node$<$ T $>$\+::timeout\+\_\+task\+\_\+id\+\_\+, v8\+::internal\+::\+Cancelable\+Task\+Manager\+::\+Try\+Abort(), USE, and V8\+\_\+\+UNLIKELY.



Referenced by Handle\+Async\+Timeout().

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=550pt]{classv8_1_1internal_1_1JSAtomicsCondition_a8080e9285ba0fe037c19e3ae9ebcfb1c_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classv8_1_1internal_1_1JSAtomicsCondition_a8080e9285ba0fe037c19e3ae9ebcfb1c_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classv8_1_1internal_1_1JSAtomicsCondition_ac64fec0a6cc4d23c2cb63e4ba80f72cd}\label{classv8_1_1internal_1_1JSAtomicsCondition_ac64fec0a6cc4d23c2cb63e4ba80f72cd}} 
\index{v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}!HandleAsyncTimeout@{HandleAsyncTimeout}}
\index{HandleAsyncTimeout@{HandleAsyncTimeout}!v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}}
\doxysubsubsection{\texorpdfstring{HandleAsyncTimeout()}{HandleAsyncTimeout()}}
{\footnotesize\ttfamily void v8\+::internal\+::\+JSAtomics\+Condition\+::\+Handle\+Async\+Timeout (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacev8_1_1internal_a2f74056d959689b951d0d45ce2fe9dfe}{Wait\+Async\+Waiter\+Queue\+Node}} $\ast$}]{node }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 1334 of file js-\/atomics-\/synchronization.\+cc.


\begin{DoxyCode}{0}
\DoxyCodeLine{1334                                                                             \{}
\DoxyCodeLine{1335   Isolate* requester = waiter-\/>requester\_;}
\DoxyCodeLine{1336   \textcolor{keywordflow}{if} (\mbox{\hyperlink{v8config_8h_a67bd29db07c711b0fb11ff1c324ebb60}{V8\_UNLIKELY}}(waiter-\/>native\_context\_.IsEmpty())) \{}
\DoxyCodeLine{1337     \textcolor{comment}{// The native context was destroyed so the promise was already removed}}
\DoxyCodeLine{1338     \textcolor{comment}{// from the native context. Remove the node from the async unlocked waiter}}
\DoxyCodeLine{1339     \textcolor{comment}{// list.}}
\DoxyCodeLine{1340     \mbox{\hyperlink{classv8_1_1internal_1_1detail_1_1AsyncWaiterQueueNode_a52115608b23a4b7d2d5e8fd0ffffa1d0}{WaitAsyncWaiterQueueNode::RemoveFromAsyncWaiterQueueList}}(waiter);}
\DoxyCodeLine{1341     \textcolor{keywordflow}{return};}
\DoxyCodeLine{1342   \}}
\DoxyCodeLine{1343   HandleScope scope(requester);}
\DoxyCodeLine{1344   DirectHandle<JSAtomicsCondition> cv = waiter-\/>GetSynchronizationPrimitive();}
\DoxyCodeLine{1345   std::atomic<StateT>* state = cv-\/>AtomicStatePtr();}
\DoxyCodeLine{1346   uint32\_t num\_dequeued =}
\DoxyCodeLine{1347       \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_a78ddcc4925d1be48d26a3893d650ee08}{DequeueExplicit}}(requester, cv, state, [\&](WaiterQueueNode** waiter\_head) \{}
\DoxyCodeLine{1348         WaiterQueueNode* dequeued = \mbox{\hyperlink{classv8_1_1internal_1_1detail_1_1WaiterQueueNode_ae672d68e7aa4d9a4e071c204a98ce022}{WaiterQueueNode::DequeueMatching}}(}
\DoxyCodeLine{1349             waiter\_head, [\&](WaiterQueueNode* node) \{ \textcolor{keywordflow}{return} node == waiter; \});}
\DoxyCodeLine{1350         \textcolor{keywordflow}{return} dequeued ? 1 : 0;}
\DoxyCodeLine{1351       \});}
\DoxyCodeLine{1352   \textcolor{comment}{// If the waiter is not in the queue, the notify task is already in the event}}
\DoxyCodeLine{1353   \textcolor{comment}{// loop, so cancel the notify task.}}
\DoxyCodeLine{1354   \textcolor{keywordflow}{if} (num\_dequeued == 0) \{}
\DoxyCodeLine{1355     \mbox{\hyperlink{namespacev8_1_1internal_a4a7a0d7631497f73ac7e69b8cfd67a66}{TryAbortResult}} abort\_result =}
\DoxyCodeLine{1356         requester-\/>cancelable\_task\_manager()-\/>TryAbort(waiter-\/>notify\_task\_id\_);}
\DoxyCodeLine{1357     \mbox{\hyperlink{src_2base_2logging_8h_af9c313d74155f7f201955a939e24c71f}{DCHECK\_EQ}}(abort\_result, \mbox{\hyperlink{namespacev8_1_1internal_a4a7a0d7631497f73ac7e69b8cfd67a66ac6e752bc3177d9fc3f0c9bc51604d37f}{TryAbortResult::kTaskAborted}});}
\DoxyCodeLine{1358     \mbox{\hyperlink{src_2base_2macros_8h_a280b0798f270f4b3f361c9ab64832956}{USE}}(abort\_result);}
\DoxyCodeLine{1359   \}}
\DoxyCodeLine{1360   \textcolor{comment}{// Reset the timeout task id to kInvalidTaskId, otherwise the notify task will}}
\DoxyCodeLine{1361   \textcolor{comment}{// try to cancel it.}}
\DoxyCodeLine{1362   waiter-\/>timeout\_task\_id\_ = \mbox{\hyperlink{classv8_1_1internal_1_1CancelableTaskManager_aeced01d51e2e17fe43f5286404519146}{CancelableTaskManager::kInvalidTaskId}};}
\DoxyCodeLine{1363   \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_a8080e9285ba0fe037c19e3ae9ebcfb1c}{JSAtomicsCondition::HandleAsyncNotify}}(waiter);}
\DoxyCodeLine{1364 \}}

\end{DoxyCode}


References v8\+::internal\+::\+Isolate\+::cancelable\+\_\+task\+\_\+manager(), DCHECK\+\_\+\+EQ, Dequeue\+Explicit(), v8\+::internal\+::detail\+::\+Waiter\+Queue\+Node\+::\+Dequeue\+Matching(), v8\+::internal\+::detail\+::\+Async\+Waiter\+Queue\+Node$<$ T $>$\+::\+Get\+Synchronization\+Primitive(), Handle\+Async\+Notify(), v8\+::api\+\_\+internal\+::\+Indirect\+Handle\+Base\+::\+Is\+Empty(), v8\+::internal\+::\+Cancelable\+Task\+Manager\+::k\+Invalid\+Task\+Id, v8\+::internal\+::k\+Task\+Aborted, v8\+::internal\+::detail\+::\+Async\+Waiter\+Queue\+Node$<$ T $>$\+::native\+\_\+context\+\_\+, v8\+::internal\+::detail\+::\+Async\+Waiter\+Queue\+Node$<$ T $>$\+::notify\+\_\+task\+\_\+id\+\_\+, v8\+::internal\+::detail\+::\+Async\+Waiter\+Queue\+Node$<$ T $>$\+::\+Remove\+From\+Async\+Waiter\+Queue\+List(), v8\+::internal\+::detail\+::\+Waiter\+Queue\+Node\+::requester\+\_\+, v8\+::internal\+::detail\+::\+Async\+Waiter\+Queue\+Node$<$ T $>$\+::timeout\+\_\+task\+\_\+id\+\_\+, v8\+::internal\+::\+Cancelable\+Task\+Manager\+::\+Try\+Abort(), USE, and V8\+\_\+\+UNLIKELY.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classv8_1_1internal_1_1JSAtomicsCondition_ac64fec0a6cc4d23c2cb63e4ba80f72cd_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classv8_1_1internal_1_1JSAtomicsCondition_ae6324d997082736b35e9aef9a3243dcd}\label{classv8_1_1internal_1_1JSAtomicsCondition_ae6324d997082736b35e9aef9a3243dcd}} 
\index{v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}!Notify@{Notify}}
\index{Notify@{Notify}!v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}}
\doxysubsubsection{\texorpdfstring{Notify()}{Notify()}}
{\footnotesize\ttfamily uint32\+\_\+t v8\+::internal\+::\+JSAtomics\+Condition\+::\+Notify (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classv8_1_1internal_1_1Isolate}{Isolate}} $\ast$}]{requester,  }\item[{\mbox{\hyperlink{classv8_1_1internal_1_1DirectHandle}{Direct\+Handle}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition}{JSAtomics\+Condition}} $>$}]{cv,  }\item[{uint32\+\_\+t}]{count }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 1251 of file js-\/atomics-\/synchronization.\+cc.


\begin{DoxyCode}{0}
\DoxyCodeLine{1253                                                     \{}
\DoxyCodeLine{1254   std::atomic<StateT>* state = cv-\/>AtomicStatePtr();}
\DoxyCodeLine{1255 }
\DoxyCodeLine{1256   \textcolor{comment}{// Dequeue count waiters.}}
\DoxyCodeLine{1257   \textcolor{keywordflow}{return} \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_a78ddcc4925d1be48d26a3893d650ee08}{DequeueExplicit}}(}
\DoxyCodeLine{1258       requester, cv, state, [=](WaiterQueueNode** waiter\_head) -\/> uint32\_t \{}
\DoxyCodeLine{1259         WaiterQueueNode* old\_head;}
\DoxyCodeLine{1260         \textcolor{keywordflow}{if} (count == 1) \{}
\DoxyCodeLine{1261           old\_head = \mbox{\hyperlink{classv8_1_1internal_1_1detail_1_1WaiterQueueNode_ab5c593f10eda6b809da72dda2e1690f2}{WaiterQueueNode::Dequeue}}(waiter\_head);}
\DoxyCodeLine{1262           \textcolor{keywordflow}{if} (!old\_head) \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{1263           old\_head-\/>Notify();}
\DoxyCodeLine{1264           \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{1265         \}}
\DoxyCodeLine{1266         \textcolor{keywordflow}{if} (count == \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_aae1f923bd44e58174430c354950d5b32}{kAllWaiters}}) \{}
\DoxyCodeLine{1267           old\_head = *waiter\_head;}
\DoxyCodeLine{1268           *waiter\_head = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{1269         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1270           old\_head = \mbox{\hyperlink{classv8_1_1internal_1_1detail_1_1WaiterQueueNode_af00af8e021183ebf4f6f0654cafdab62}{WaiterQueueNode::Split}}(waiter\_head, count);}
\DoxyCodeLine{1271         \}}
\DoxyCodeLine{1272         \textcolor{keywordflow}{if} (!old\_head) \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{1273         \textcolor{comment}{// Notify while holding the queue lock to avoid notifying}}
\DoxyCodeLine{1274         \textcolor{comment}{// waiters that have been deleted in other threads.}}
\DoxyCodeLine{1275         \textcolor{keywordflow}{return} old\_head-\/>NotifyAllInList();}
\DoxyCodeLine{1276       \});}
\DoxyCodeLine{1277 \}}

\end{DoxyCode}


References v8\+::internal\+::detail\+::\+Waiter\+Queue\+Node\+::\+Dequeue(), Dequeue\+Explicit(), k\+All\+Waiters, v8\+::internal\+::detail\+::\+Waiter\+Queue\+Node\+::\+Notify(), v8\+::internal\+::detail\+::\+Waiter\+Queue\+Node\+::\+Notify\+All\+In\+List(), and v8\+::internal\+::detail\+::\+Waiter\+Queue\+Node\+::\+Split().



Referenced by v8\+::internal\+::\+BUILTIN().

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classv8_1_1internal_1_1JSAtomicsCondition_ae6324d997082736b35e9aef9a3243dcd_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classv8_1_1internal_1_1JSAtomicsCondition_ae6324d997082736b35e9aef9a3243dcd_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classv8_1_1internal_1_1JSAtomicsCondition_a51f385dcf4789296cf3021d2e6f520c5}\label{classv8_1_1internal_1_1JSAtomicsCondition_a51f385dcf4789296cf3021d2e6f520c5}} 
\index{v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}!QueueWaiter@{QueueWaiter}}
\index{QueueWaiter@{QueueWaiter}!v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}}
\doxysubsubsection{\texorpdfstring{QueueWaiter()}{QueueWaiter()}}
{\footnotesize\ttfamily void v8\+::internal\+::\+JSAtomics\+Condition\+::\+Queue\+Waiter (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classv8_1_1internal_1_1Isolate}{Isolate}} $\ast$}]{requester,  }\item[{\mbox{\hyperlink{classv8_1_1internal_1_1DirectHandle}{Direct\+Handle}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition}{JSAtomics\+Condition}} $>$}]{cv,  }\item[{\mbox{\hyperlink{classv8_1_1internal_1_1detail_1_1WaiterQueueNode}{Waiter\+Queue\+Node}} $\ast$}]{waiter }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [private]}}



Definition at line 1153 of file js-\/atomics-\/synchronization.\+cc.


\begin{DoxyCode}{0}
\DoxyCodeLine{1155                                                               \{}
\DoxyCodeLine{1156   \textcolor{comment}{// The state pointer should not be used outside of this block as a shared GC}}
\DoxyCodeLine{1157   \textcolor{comment}{// may reallocate it after waiting.}}
\DoxyCodeLine{1158   std::atomic<StateT>* state = cv-\/>AtomicStatePtr();}
\DoxyCodeLine{1159 }
\DoxyCodeLine{1160   \textcolor{comment}{// Try to acquire the queue lock, which is itself a spinlock.}}
\DoxyCodeLine{1161   StateT current\_state = state-\/>load(std::memory\_order\_relaxed);}
\DoxyCodeLine{1162   WaiterQueueLockGuard waiter\_queue\_lock\_guard(state, current\_state);}
\DoxyCodeLine{1163 }
\DoxyCodeLine{1164   \textcolor{comment}{// With the queue lock held, enqueue the requester onto the waiter queue.}}
\DoxyCodeLine{1165   WaiterQueueNode* waiter\_head = cv-\/>DestructivelyGetWaiterQueueHead(requester);}
\DoxyCodeLine{1166   \mbox{\hyperlink{classv8_1_1internal_1_1detail_1_1WaiterQueueNode_a639d7e56545b8e47357d1564989d070d}{WaiterQueueNode::Enqueue}}(\&waiter\_head, waiter);}
\DoxyCodeLine{1167 }
\DoxyCodeLine{1168   \textcolor{comment}{// Release the queue lock and install the new waiter queue head.}}
\DoxyCodeLine{1169   \mbox{\hyperlink{src_2base_2logging_8h_af9c313d74155f7f201955a939e24c71f}{DCHECK\_EQ}}(state-\/>load(),}
\DoxyCodeLine{1170             IsWaiterQueueLockedField::update(current\_state, \textcolor{keyword}{true}));}
\DoxyCodeLine{1171   StateT new\_state =}
\DoxyCodeLine{1172       cv-\/>SetWaiterQueueHead(requester, waiter\_head, current\_state);}
\DoxyCodeLine{1173   waiter\_queue\_lock\_guard.set\_new\_state(new\_state);}
\DoxyCodeLine{1174 \}}

\end{DoxyCode}


References DCHECK\+\_\+\+EQ, v8\+::internal\+::detail\+::\+Waiter\+Queue\+Node\+::\+Enqueue(), and v8\+::internal\+::detail\+::\+Waiter\+Queue\+Lock\+Guard\+::set\+\_\+new\+\_\+state().



Referenced by Wait\+Async(), and Wait\+For().

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classv8_1_1internal_1_1JSAtomicsCondition_a51f385dcf4789296cf3021d2e6f520c5_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classv8_1_1internal_1_1JSAtomicsCondition_a51f385dcf4789296cf3021d2e6f520c5_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classv8_1_1internal_1_1JSAtomicsCondition_a0a626b72e905bbeccb72b5f15d9bafbb}\label{classv8_1_1internal_1_1JSAtomicsCondition_a0a626b72e905bbeccb72b5f15d9bafbb}} 
\index{v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}!WaitAsync@{WaitAsync}}
\index{WaitAsync@{WaitAsync}!v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}}
\doxysubsubsection{\texorpdfstring{WaitAsync()}{WaitAsync()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classv8_1_1internal_1_1MaybeDirectHandle}{Maybe\+Direct\+Handle}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1JSReceiver}{JSReceiver}} $>$ v8\+::internal\+::\+JSAtomics\+Condition\+::\+Wait\+Async (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classv8_1_1internal_1_1Isolate}{Isolate}} $\ast$}]{requester,  }\item[{\mbox{\hyperlink{classv8_1_1internal_1_1DirectHandle}{Direct\+Handle}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition}{JSAtomics\+Condition}} $>$}]{cv,  }\item[{\mbox{\hyperlink{classv8_1_1internal_1_1DirectHandle}{Direct\+Handle}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsMutex}{JSAtomics\+Mutex}} $>$}]{mutex,  }\item[{std\+::optional$<$ \mbox{\hyperlink{classv8_1_1base_1_1TimeDelta}{base\+::\+Time\+Delta}} $>$}]{timeout }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 1287 of file js-\/atomics-\/synchronization.\+cc.


\begin{DoxyCode}{0}
\DoxyCodeLine{1290                                         \{}
\DoxyCodeLine{1291   Handle<JSPromise> internal\_waiting\_promise =}
\DoxyCodeLine{1292       requester-\/>factory()-\/>NewJSPromise();}
\DoxyCodeLine{1293   DirectHandle<Context> handler\_context =}
\DoxyCodeLine{1294       requester-\/>factory()-\/>NewBuiltinContext(requester-\/>native\_context(),}
\DoxyCodeLine{1295                                               \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_a52db506cdcf0855042f99540cbd239b0a764f0bf2ad34211e2f7f07c2dde3d8f7}{kAsyncContextLength}});}
\DoxyCodeLine{1296   handler\_context-\/>SetNoCell(\mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_a52db506cdcf0855042f99540cbd239b0a1dd6cb256d96770ef2df784e8124d0ab}{kMutexAsyncContextSlot}}, *mutex);}
\DoxyCodeLine{1297   handler\_context-\/>SetNoCell(\mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_a52db506cdcf0855042f99540cbd239b0ab53a7c551e9fac0a1718c829d1450b73}{kConditionVariableAsyncContextSlot}}, *cv);}
\DoxyCodeLine{1298 }
\DoxyCodeLine{1299   DirectHandle<SharedFunctionInfo> info(}
\DoxyCodeLine{1300       requester-\/>heap()-\/>atomics\_condition\_acquire\_lock\_sfi(), requester);}
\DoxyCodeLine{1301   DirectHandle<JSFunction> lock\_function =}
\DoxyCodeLine{1302       Factory::JSFunctionBuilder\{requester, info, handler\_context\}}
\DoxyCodeLine{1303           .set\_map(requester-\/>strict\_function\_without\_prototype\_map())}
\DoxyCodeLine{1304           .Build();}
\DoxyCodeLine{1305 }
\DoxyCodeLine{1306   DirectHandle<JSReceiver> lock\_promise;}
\DoxyCodeLine{1307 }
\DoxyCodeLine{1308   \mbox{\hyperlink{execution_2isolate_8h_a45bb81ab232e9f2663545ec92dc0b950}{ASSIGN\_RETURN\_ON\_EXCEPTION}}(}
\DoxyCodeLine{1309       requester, lock\_promise,}
\DoxyCodeLine{1310       \mbox{\hyperlink{namespacev8_1_1internal_1_1anonymous__namespace_02js-atomics-synchronization_8cc_03_a5e71d6d2dee15c738e0fc3ce715c12f4}{PerformPromiseThen}}(requester, internal\_waiting\_promise, lock\_function));}
\DoxyCodeLine{1311 }
\DoxyCodeLine{1312   \textcolor{comment}{// Create a new async waiter node in the C++ heap. Its lifetime is managed by}}
\DoxyCodeLine{1313   \textcolor{comment}{// the requester's `async\_waiter\_queue\_nodes` list.}}
\DoxyCodeLine{1314   \mbox{\hyperlink{namespacev8_1_1internal_a2f74056d959689b951d0d45ce2fe9dfe}{WaitAsyncWaiterQueueNode}}* this\_waiter =}
\DoxyCodeLine{1315       \mbox{\hyperlink{classv8_1_1internal_1_1detail_1_1AsyncWaiterQueueNode_aedd8acca7e7b7094e41c594ad63bd0d3}{WaitAsyncWaiterQueueNode::NewAsyncWaiterStoredInIsolate}}(}
\DoxyCodeLine{1316           requester, cv, internal\_waiting\_promise);}
\DoxyCodeLine{1317   \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_a51f385dcf4789296cf3021d2e6f520c5}{QueueWaiter}}(requester, cv, this\_waiter);}
\DoxyCodeLine{1318 }
\DoxyCodeLine{1319   \textcolor{keywordflow}{if} (timeout) \{}
\DoxyCodeLine{1320     \mbox{\hyperlink{namespacecppgc_a3c2b2bee060b35e6507a2d25c5e5abc7}{TaskRunner}}* taks\_runner = this\_waiter-\/>task\_runner();}
\DoxyCodeLine{1321     \textcolor{keyword}{auto} task = std::make\_unique<AsyncWaitTimeoutTask>(}
\DoxyCodeLine{1322         requester-\/>cancelable\_task\_manager(), this\_waiter);}
\DoxyCodeLine{1323     this\_waiter-\/>timeout\_task\_id\_ = task-\/>id();}
\DoxyCodeLine{1324     taks\_runner-\/>PostNonNestableDelayedTask(std::move(task),}
\DoxyCodeLine{1325                                             timeout-\/>InSecondsF());}
\DoxyCodeLine{1326   \}}
\DoxyCodeLine{1327   mutex-\/>Unlock(requester);}
\DoxyCodeLine{1328   \textcolor{comment}{// Keep the wait promise alive in the native context.}}
\DoxyCodeLine{1329   \mbox{\hyperlink{namespacev8_1_1internal_1_1anonymous__namespace_02js-atomics-synchronization_8cc_03_a97622f0c584c7ed91eab0d5cd7a53470}{AddPromiseToNativeContext}}(requester, internal\_waiting\_promise);}
\DoxyCodeLine{1330   \textcolor{keywordflow}{return} lock\_promise;}
\DoxyCodeLine{1331 \}}

\end{DoxyCode}


References v8\+::internal\+::anonymous\+\_\+namespace\{js-\/atomics-\/synchronization.\+cc\}\+::\+Add\+Promise\+To\+Native\+Context(), ASSIGN\+\_\+\+RETURN\+\_\+\+ON\+\_\+\+EXCEPTION, v8\+::internal\+::\+Isolate\+::cancelable\+\_\+task\+\_\+manager(), v8\+::internal\+::\+Isolate\+::factory(), v8\+::internal\+::\+Isolate\+::heap(), k\+Async\+Context\+Length, k\+Condition\+Variable\+Async\+Context\+Slot, k\+Mutex\+Async\+Context\+Slot, v8\+::internal\+::\+Isolate\+::native\+\_\+context(), v8\+::internal\+::detail\+::\+Async\+Waiter\+Queue\+Node$<$ T $>$\+::\+New\+Async\+Waiter\+Stored\+In\+Isolate(), v8\+::internal\+::\+Factory\+::\+New\+Builtin\+Context(), v8\+::internal\+::\+Factory\+::\+New\+JSPromise(), v8\+::internal\+::anonymous\+\_\+namespace\{js-\/atomics-\/synchronization.\+cc\}\+::\+Perform\+Promise\+Then(), v8\+::\+Task\+Runner\+::\+Post\+Non\+Nestable\+Delayed\+Task(), Queue\+Waiter(), v8\+::internal\+::detail\+::\+Async\+Waiter\+Queue\+Node$<$ T $>$\+::task\+\_\+runner(), and v8\+::internal\+::detail\+::\+Async\+Waiter\+Queue\+Node$<$ T $>$\+::timeout\+\_\+task\+\_\+id\+\_\+.



Referenced by v8\+::internal\+::\+BUILTIN().

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classv8_1_1internal_1_1JSAtomicsCondition_a0a626b72e905bbeccb72b5f15d9bafbb_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classv8_1_1internal_1_1JSAtomicsCondition_a0a626b72e905bbeccb72b5f15d9bafbb_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classv8_1_1internal_1_1JSAtomicsCondition_af9e08e07218a45361ad3e9e3a27cf15a}\label{classv8_1_1internal_1_1JSAtomicsCondition_af9e08e07218a45361ad3e9e3a27cf15a}} 
\index{v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}!WaitFor@{WaitFor}}
\index{WaitFor@{WaitFor}!v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}}
\doxysubsubsection{\texorpdfstring{WaitFor()}{WaitFor()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacev8_1_1internal_a4e2118a7c0d730210e0cb87b511cba70}{bool}} v8\+::internal\+::\+JSAtomics\+Condition\+::\+Wait\+For (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classv8_1_1internal_1_1Isolate}{Isolate}} $\ast$}]{requester,  }\item[{\mbox{\hyperlink{classv8_1_1internal_1_1DirectHandle}{Direct\+Handle}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition}{JSAtomics\+Condition}} $>$}]{cv,  }\item[{\mbox{\hyperlink{classv8_1_1internal_1_1DirectHandle}{Direct\+Handle}}$<$ \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsMutex}{JSAtomics\+Mutex}} $>$}]{mutex,  }\item[{std\+::optional$<$ \mbox{\hyperlink{classv8_1_1base_1_1TimeDelta}{base\+::\+Time\+Delta}} $>$}]{timeout }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 1177 of file js-\/atomics-\/synchronization.\+cc.


\begin{DoxyCode}{0}
\DoxyCodeLine{1180                                                                      \{}
\DoxyCodeLine{1181   \mbox{\hyperlink{namespacev8_1_1internal_af2248a427f8ff8f81e68a2a87758e145}{DisallowGarbageCollection}} \mbox{\hyperlink{namespacev8_1_1internal_1_1anonymous__namespace_02json-stringifier_8cc_03_a63d8eefb47468aa3f816fbe26a59466a}{no\_gc}};}
\DoxyCodeLine{1182 }
\DoxyCodeLine{1183   \textcolor{keywordtype}{bool} rv;}
\DoxyCodeLine{1184   \{}
\DoxyCodeLine{1185     \textcolor{comment}{// Allocate a waiter queue node on-\/stack, since this thread is going to}}
\DoxyCodeLine{1186     \textcolor{comment}{// sleep and will be blocked anyway.}}
\DoxyCodeLine{1187     SyncWaiterQueueNode this\_waiter(requester);}
\DoxyCodeLine{1188 }
\DoxyCodeLine{1189     \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_a51f385dcf4789296cf3021d2e6f520c5}{JSAtomicsCondition::QueueWaiter}}(requester, cv, \&this\_waiter);}
\DoxyCodeLine{1190 }
\DoxyCodeLine{1191     \textcolor{comment}{// Release the mutex and wait for another thread to wake us up, reacquiring}}
\DoxyCodeLine{1192     \textcolor{comment}{// the mutex upon wakeup.}}
\DoxyCodeLine{1193     mutex-\/>Unlock(requester);}
\DoxyCodeLine{1194     \textcolor{keywordflow}{if} (timeout) \{}
\DoxyCodeLine{1195       rv = this\_waiter.WaitFor(*timeout);}
\DoxyCodeLine{1196       \textcolor{keywordflow}{if} (!rv) \{}
\DoxyCodeLine{1197         \textcolor{comment}{// If timed out, remove ourself from the waiter list, which is usually}}
\DoxyCodeLine{1198         \textcolor{comment}{// done by the thread performing the notifying.}}
\DoxyCodeLine{1199         std::atomic<StateT>* state = cv-\/>AtomicStatePtr();}
\DoxyCodeLine{1200         \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsCondition_a78ddcc4925d1be48d26a3893d650ee08}{DequeueExplicit}}(}
\DoxyCodeLine{1201             requester, cv, state, [\&](WaiterQueueNode** waiter\_head) \{}
\DoxyCodeLine{1202               WaiterQueueNode* dequeued = \mbox{\hyperlink{classv8_1_1internal_1_1detail_1_1WaiterQueueNode_ae672d68e7aa4d9a4e071c204a98ce022}{WaiterQueueNode::DequeueMatching}}(}
\DoxyCodeLine{1203                   waiter\_head,}
\DoxyCodeLine{1204                   [\&](WaiterQueueNode* node) \{ \textcolor{keywordflow}{return} node == \&this\_waiter; \});}
\DoxyCodeLine{1205               \textcolor{keywordflow}{return} dequeued ? 1 : 0;}
\DoxyCodeLine{1206             \});}
\DoxyCodeLine{1207       \}}
\DoxyCodeLine{1208     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1209       this\_waiter.Wait();}
\DoxyCodeLine{1210       rv = \textcolor{keyword}{true};}
\DoxyCodeLine{1211     \}}
\DoxyCodeLine{1212   \}}
\DoxyCodeLine{1213   \mbox{\hyperlink{classv8_1_1internal_1_1JSAtomicsMutex_a4ebd969fa7c9e3b1087beb252d802a15}{JSAtomicsMutex::Lock}}(requester, mutex);}
\DoxyCodeLine{1214   \textcolor{keywordflow}{return} rv;}
\DoxyCodeLine{1215 \}}

\end{DoxyCode}


References Dequeue\+Explicit(), v8\+::internal\+::detail\+::\+Waiter\+Queue\+Node\+::\+Dequeue\+Matching(), v8\+::internal\+::\+JSAtomics\+Mutex\+::\+Lock(), v8\+::internal\+::anonymous\+\_\+namespace\{json-\/stringifier.\+cc\}\+::no\+\_\+gc, Queue\+Waiter(), v8\+::internal\+::detail\+::\+Sync\+Waiter\+Queue\+Node\+::\+Wait(), and v8\+::internal\+::detail\+::\+Sync\+Waiter\+Queue\+Node\+::\+Wait\+For().



Referenced by v8\+::internal\+::\+BUILTIN().

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classv8_1_1internal_1_1JSAtomicsCondition_af9e08e07218a45361ad3e9e3a27cf15a_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classv8_1_1internal_1_1JSAtomicsCondition_af9e08e07218a45361ad3e9e3a27cf15a_icgraph}
\end{center}
\end{figure}


\doxysubsection{Friends And Related Function Documentation}
\mbox{\Hypertarget{classv8_1_1internal_1_1JSAtomicsCondition_a328c093d609680cca505905c6d49901a}\label{classv8_1_1internal_1_1JSAtomicsCondition_a328c093d609680cca505905c6d49901a}} 
\index{v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}!Factory@{Factory}}
\index{Factory@{Factory}!v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}}
\doxysubsubsection{\texorpdfstring{Factory}{Factory}}
{\footnotesize\ttfamily friend class \mbox{\hyperlink{classv8_1_1internal_1_1Factory}{Factory}}\hspace{0.3cm}{\ttfamily [friend]}}



Definition at line 441 of file js-\/atomics-\/synchronization.\+h.



\doxysubsection{Member Data Documentation}
\mbox{\Hypertarget{classv8_1_1internal_1_1JSAtomicsCondition_aae1f923bd44e58174430c354950d5b32}\label{classv8_1_1internal_1_1JSAtomicsCondition_aae1f923bd44e58174430c354950d5b32}} 
\index{v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}!kAllWaiters@{kAllWaiters}}
\index{kAllWaiters@{kAllWaiters}!v8::internal::JSAtomicsCondition@{v8::internal::JSAtomicsCondition}}
\doxysubsubsection{\texorpdfstring{kAllWaiters}{kAllWaiters}}
{\footnotesize\ttfamily constexpr uint32\+\_\+t v8\+::internal\+::\+JSAtomics\+Condition\+::k\+All\+Waiters = UINT32\+\_\+\+MAX\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [constexpr]}}



Definition at line 421 of file js-\/atomics-\/synchronization.\+h.



Referenced by v8\+::internal\+::\+BUILTIN(), and Notify().



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
/mnt/\+V8\+Source\+Code/src/objects/\mbox{\hyperlink{js-atomics-synchronization_8h}{js-\/atomics-\/synchronization.\+h}}\item 
/mnt/\+V8\+Source\+Code/src/objects/\mbox{\hyperlink{js-atomics-synchronization_8cc}{js-\/atomics-\/synchronization.\+cc}}\end{DoxyCompactItemize}
